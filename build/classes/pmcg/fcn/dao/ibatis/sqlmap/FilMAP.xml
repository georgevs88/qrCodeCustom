<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Fil">
	<typeAlias alias="FilVO" type="pmcg.fcn.domain.FilVO" />


	<resultMap id="mapComplexQuerySimple" class="FilVO">
		<result property="iddfil" column="iddfil" />
		<result property="matfil" column="matfil" />
		<result property="evefil" column="evefil" />
		<result property="pvifil" column="pvifil" />
		<result property="nirfil" column="nirfil" />
		<result property="cnpfil" column="cnpfil" />
		<result property="desfil" column="desfil" />
		<result property="capfil" column="capfil" />
		<result property="dinfil" column="dinfil" />
		<result property="emafil" column="emafil" />
		<result property="nomfil" column="nomfil" />
		<result property="endfil" column="endfil" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="FilVO">
		<result property="iddfil" column="iddfil" />
		<result property="matfil" column="matfil" />
		<result property="evefil" column="evefil" />
		<result property="pvifil" column="pvifil" />
		<result property="nirfil" column="nirfil" />
		<result property="cnpfil" column="cnpfil" />
		<result property="desfil" column="desfil" />
		<result property="capfil" column="capfil" />
		<result property="dinfil" column="dinfil" />
		<result property="emafil" column="emafil" />
		<result property="nomfil" column="nomfil" />
		<result property="endfil" column="endfil" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnfil WHERE iddfil = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnfil WHERE iddfil = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="FilVO"
		resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnfil
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddfil" prepend=" AND ">
				iddfil = #iddfil:NUMERIC#
			</isNotNull>
			<isNotNull property="evefil" prepend=" AND ">
				evefil ILIKE '%' || #evefil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="pvifil" prepend=" AND ">
				pvifil ILIKE '%' || #pvifil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nirfil" prepend=" AND ">
				nirfil ILIKE '%' || #nirfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="cnpfil" prepend=" AND ">
				cnpfil ILIKE '%' || #cnpfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="desfil" prepend=" AND ">
				desfil ILIKE '%' || #desfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="capfil" prepend=" AND ">
				capfil ILIKE '%' || #capfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dinfil" prepend=" AND ">
				to_char(dinfil,'dd/MM/yyyy') =
				to_char(#dinfil:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="emafil" prepend=" AND ">
				emafil ILIKE '%' || #emafil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomfil" prepend=" AND ">
				nomfil ILIKE '%' || #nomfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="endfil" prepend=" AND ">
				endfil = #endfil:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="FilVO"
		resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnfil
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddfil" prepend=" AND "> iddfil =
				#iddfil:NUMERIC#
			</isNotNull>
			<isNotNull property="evefil" prepend=" AND ">
				evefil ILIKE '%' || #evefil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="pvifil" prepend=" AND ">
				pvifil ILIKE '%' || #pvifil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nirfil" prepend=" AND ">
				nirfil ILIKE '%' || #nirfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="cnpfil" prepend=" AND ">
				cnpfil ILIKE '%' || #cnpfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="desfil" prepend=" AND ">
				desfil ILIKE '%' || #desfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="capfil" prepend=" AND ">
				capfil ILIKE '%' || #capfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dinfil" prepend=" AND ">
				to_char(dinfil,'dd/MM/yyyy') =
				to_char(#dinfil:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="emafil" prepend=" AND ">
				emafil ILIKE '%' || #emafil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomfil" prepend=" AND ">
				nomfil ILIKE '%' || #nomfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="endfil" prepend=" AND "> endfil =
				#endfil:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnfil
	</select>

	<insert id="insReg" parameterClass="FilVO">
		<selectKey keyProperty="iddfil" resultClass="Long">
			SELECT NEXTVAL('fcn.seqfil')
		</selectKey>
		INSERT INTO
		fcn.fcnfil(iddfil,matfil,evefil,pvifil,nirfil,cnpfil,desfil,capfil,dinfil,emafil,nomfil,endfil)
		VALUES (#iddfil:NUMERIC#, #matfil:NUMERIC#, UPPER(#evefil:VARCHAR#),
		UPPER(#pvifil:VARCHAR#), UPPER(#nirfil:VARCHAR#),
		UPPER(#cnpfil:VARCHAR#), UPPER(#desfil:VARCHAR#),
		UPPER(#capfil:VARCHAR#),#dinfil:TIMESTAMP#, #emafil:VARCHAR#,
		UPPER(#nomfil:VARCHAR#),#endfil:NUMERIC# )
	</insert>

	<update id="updRegByCod" parameterClass="FilVO">
		UPDATE 
			fcn.fcnfil 
		SET 
			matfil = #matfil:NUMERIC#, 
			evefil = UPPER(#evefil:VARCHAR#),
			pvifil = UPPER(#pvifil:VARCHAR#),
			nirfil = UPPER(#nirfil:VARCHAR#),
			cnpfil = UPPER(#cnpfil:VARCHAR#),
			desfil = UPPER(#desfil:VARCHAR#),
			capfil = UPPER(#capfil:VARCHAR#),
			dinfil = #dinfil:TIMESTAMP#,
			emafil = #emafil:VARCHAR#,
			nomfil = UPPER(#nomfil:VARCHAR#),
			endfil = #endfil:NUMERIC# 
		WHERE 
			iddfil = #iddfil:NUMERIC#
	</update>
	
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM fcn.fcnfil WHERE iddfil = #value:NUMERIC#
	</delete>
	
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM fcn.fcnfil WHERE iddfil in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="FilVO"
		resultClass="Integer">
		SELECT count(iddfil) FROM fcn.fcnfil
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddfil" prepend=" AND "> iddfil =
				#iddfil:NUMERIC#
			</isNotNull>
			<isNotNull property="evefil" prepend=" AND ">
				evefil ILIKE '%' || #evefil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="pvifil" prepend=" AND ">
				pvifil ILIKE '%' || #pvifil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nirfil" prepend=" AND ">
				nirfil ILIKE '%' || #nirfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="cnpfil" prepend=" AND ">
				cnpfil ILIKE '%' || #cnpfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="desfil" prepend=" AND ">
				desfil ILIKE '%' || #desfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="capfil" prepend=" AND ">
				capfil ILIKE '%' || #capfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dinfil" prepend=" AND ">
				to_char(dinfil,'dd/MM/yyyy') =
				to_char(#dinfil:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="emafil" prepend=" AND ">
				emafil ILIKE '%' || #emafil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomfil" prepend=" AND ">
				nomfil ILIKE '%' || #nomfil:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="endfil" prepend=" AND "> endfil =
				#endfil:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getFilByMatriz" parameterClass="Long" resultClass="hashmap">
		select 
			iddfil, tabeve.destab as evefil,pvifil,nirfil,fcn.formatacpfcnpj(cnpfil) as cnpfil,desfil,
			fcn.formatavalorjunta(capfil) as capfil, to_char(dinfil, 'dd/MM/yyyy') as dinfil,emafil,nomfil, fcn.getendereco(endfil) as endfil
		from 
			fcn.fcnfil fil
			left join fcn.fcntab tabeve on (tabeve.tabtab = 'EVENTO' AND tabeve.codtab = fil.evefil)
		where 
			fil.matfil = #value:NUMERIC#
	</select>
</sqlMap> 
 