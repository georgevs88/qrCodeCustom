<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Anx">
	<typeAlias alias="AnxVO" type="pmcg.fcn.domain.AnxVO" />

	<resultMap id="mapComplexQuerySimple" class="AnxVO">
		<result property="iddanx" column="iddanx" />
		<result property="docanx" column="docanx" />
		<result property="tpdanx" column="tpdanx" />
		<result property="arqanx" column="arqanx" />
		<result property="desanx" column="desanx" />
		<result property="nomanx" column="nomanx" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="AnxVO">
		<result property="iddanx" column="iddanx" />
		<result property="docanx" column="docanx" />
		<result property="tpdanx" column="tpdanx" />
		<result property="arqanx" column="arqanx" />
		<result property="desanx" column="desanx" />
		<result property="nomanx" column="nomanx" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnanx WHERE iddanx = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnanx WHERE iddanx =
		#value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="AnxVO" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnanx
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddanx" prepend=" AND ">
				iddanx = #iddanx:NUMERIC#
			</isNotNull>
			<isNotNull property="docanx" prepend=" AND ">
				docanx = #docanx:NUMERIC#
			</isNotNull>
			<isNotNull property="arqanx" prepend=" AND ">
				arqanx = #arqanx:NUMERIC#
			</isNotNull>
			<isNotNull property="desanx" prepend=" AND ">
				desanx ILIKE '%' || #desanx:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomanx" prepend=" AND ">
				nomanx ILIKE '%' || #nomanx:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="AnxVO" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnanx
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddanx" prepend=" AND "> iddanx = #iddanx:NUMERIC#
			</isNotNull>
			<isNotNull property="docanx" prepend=" AND "> docanx = #docanx:NUMERIC#
			</isNotNull>
			<isNotNull property="arqanx" prepend=" AND "> arqanx = #arqanx:NUMERIC#
			</isNotNull>
			<isNotNull property="desanx" prepend=" AND ">
				desanx ILIKE '%' || #desanx:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomanx" prepend=" AND ">
				nomanx ILIKE '%' || #nomanx:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnanx
	</select>

	<insert id="insReg" parameterClass="AnxVO">
		<selectKey keyProperty="iddanx" resultClass="Long">
			SELECT NEXTVAL('fcn.seqanx')
		</selectKey>
		INSERT INTO fcn.fcnanx(iddanx,docanx,tpdanx,arqanx,desanx,nomanx,usualt,datalt) VALUES
		(#iddanx:NUMERIC#,#docanx:NUMERIC#,#tpdanx:VARCHAR#,#arqanx:NUMERIC#, UPPER(#desanx:VARCHAR#), #nomanx:VARCHAR#,
		UPPER(#usualt:VARCHAR#),now() )
	</insert>

	<update id="updRegByCod" parameterClass="AnxVO">
		UPDATE 
			fcn.fcnanx 
		SET 
			docanx = #docanx:NUMERIC#,
			tpdanx = #tpdanx:VARCHAR#,
			arqanx = #arqanx:NUMERIC#,
			desanx = UPPER(#desanx:VARCHAR#),
			nomanx = #nomanx:VARCHAR#,
			usualt = UPPER(#usualt:VARCHAR#),
			datalt = now() 
		WHERE 
			iddanx = #iddanx:NUMERIC#
	</update>
	
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM fcn.fcnanx WHERE iddanx = #value:NUMERIC#
	</delete>
	
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM fcn.fcnanx WHERE iddanx in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="AnxVO" resultClass="Integer">
		SELECT count(iddanx) FROM fcn.fcnanx
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddanx" prepend=" AND "> iddanx = #iddanx:NUMERIC#
			</isNotNull>
			<isNotNull property="docanx" prepend=" AND "> docanx = #docanx:NUMERIC#
			</isNotNull>
			<isNotNull property="arqanx" prepend=" AND "> arqanx = #arqanx:NUMERIC#
			</isNotNull>
			<isNotNull property="desanx" prepend=" AND ">
				desanx ILIKE '%' || #desanx:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomanx" prepend=" AND ">
				nomanx ILIKE '%' || #nomanx:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getRegByDocTpd" parameterClass="AnxVO" resultMap="mapComplexQuery">
		SELECT 
			* 
		FROM 
			fcn.fcnanx
		WHERE 
			docanx = #docanx:NUMERIC#
			and tpdanx = #tpdanx:VARCHAR#
	</select>
</sqlMap> 
 