<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Aen">
	<typeAlias alias="AenVO" type="pmcg.fcn.domain.AenVO" />


	<resultMap id="mapComplexQuerySimple" class="AenVO">
		<result property="iddaen" column="iddaen" />
		<result property="proaen" column="proaen" />
		<result property="sitaen" column="sitaen" />
		<result property="valaen" column="valaen" />
		<result property="docaen" column="docaen" />
		<result property="oriaen" column="oriaen" />
		<result property="jusaen" column="jusaen" />
		<result property="obsaen" column="obsaen" />
		<result property="taxaen" column="taxaen" />
		<result property="dataen" column="dataen" />
		<result property="usualt" column="usualt" />
		<result property="zonaen" column="zonaen" />
		<result property="usoaen" column="usoaen" />
		<result property="timaen" column="timaen" />
		<result property="risaen" column="risaen" />
		<result property="ambaen" column="ambaen" />
		<result property="bomaen" column="bomaen" />
		<result property="vigaen" column="vigaen" />
		<result property="posaen" column="posaen" />
		<result property="traaen" column="traaen" />
		<result property="siaaen" column="siaaen" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="AenVO">
		<result property="iddaen" column="iddaen" />
		<result property="proaen" column="proaen" />
		<result property="sitaen" column="sitaen" />
		<result property="valaen" column="valaen" />
		<result property="docaen" column="docaen" />
		<result property="oriaen" column="oriaen" />
		<result property="jusaen" column="jusaen" />
		<result property="obsaen" column="obsaen" />
		<result property="taxaen" column="taxaen" />
		<result property="dataen" column="dataen" />
		<result property="usualt" column="usualt" />
		<result property="zonaen" column="zonaen" />
		<result property="usoaen" column="usoaen" />
		<result property="timaen" column="timaen" />
		<result property="risaen" column="risaen" />
		<result property="ambaen" column="ambaen" />
		<result property="bomaen" column="bomaen" />
		<result property="vigaen" column="vigaen" />
		<result property="posaen" column="posaen" />
		<result property="traaen" column="traaen" />
		<result property="siaaen" column="siaaen" />
		
		<result property="listAat" select="Aat.getRegByAen" column="iddaen" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnaen WHERE iddaen = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnaen WHERE iddaen = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="AenVO"
		resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnaen
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddaen" prepend=" AND ">
				iddaen = #iddaen:NUMERIC#
			</isNotNull>
			<isNotNull property="proaen" prepend=" AND ">
				proaen ilike #proaen:VARCHAR#
			</isNotNull>
			<isNotNull property="valaen" prepend=" AND ">
				to_char(valaen,'dd/MM/yyyy') =
				to_char(#valaen:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="docaen" prepend=" AND ">
				docaen ILIKE '%' || #docaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="oriaen" prepend=" AND ">
				oriaen ILIKE '%' || #oriaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="jusaen" prepend=" AND ">
				jusaen ILIKE '%' || #jusaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="obsaen" prepend=" AND ">
				obsaen ILIKE '%' || #obsaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="taxaen" prepend=" AND ">
				taxaen ILIKE '%' || #taxaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dataen" prepend=" AND ">
				to_char(dataen,'dd/MM/yyyy') =
				to_char(#dataen:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="AenVO"
		resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnaen
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddaen" prepend=" AND "> iddaen =
				#iddaen:NUMERIC#
			</isNotNull>
			<isNotNull property="proaen" prepend=" AND "> proaen ilike
				#proaen:VARCHAR#
			</isNotNull>
			<isNotNull property="valaen" prepend=" AND ">
				to_char(valaen,'dd/MM/yyyy') =
				to_char(#valaen:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="docaen" prepend=" AND ">
				docaen ILIKE '%' || #docaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="oriaen" prepend=" AND ">
				oriaen ILIKE '%' || #oriaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="jusaen" prepend=" AND ">
				jusaen ILIKE '%' || #jusaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="obsaen" prepend=" AND ">
				obsaen ILIKE '%' || #obsaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="taxaen" prepend=" AND ">
				taxaen ILIKE '%' || #taxaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dataen" prepend=" AND ">
				to_char(dataen,'dd/MM/yyyy') =
				to_char(#dataen:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnaen
	</select>

	<insert id="insReg" parameterClass="AenVO">
		<selectKey keyProperty="iddaen" resultClass="Long">
			SELECT NEXTVAL('fcn.seqaen')
		</selectKey>
		INSERT INTO
		fcn.fcnaen(iddaen,proaen,sitaen,valaen,docaen,oriaen,jusaen,obsaen,taxaen,dataen,usualt,zonaen,usoaen,timaen,risaen,ambaen,bomaen,vigaen,posaen,traaen,siaaen)
		VALUES (#iddaen:NUMERIC#,#proaen:VARCHAR#,#sitaen:VARCHAR#,#valaen:TIMESTAMP#,
		UPPER(#docaen:VARCHAR#), UPPER(#oriaen:VARCHAR#),
		UPPER(#jusaen:VARCHAR#), UPPER(#obsaen:VARCHAR#),
		UPPER(#taxaen:VARCHAR#),now(),UPPER(#usualt:VARCHAR#),#zonaen:VARCHAR#,#usoaen:VARCHAR#,#timaen:VARCHAR#,#risaen:VARCHAR#,#ambaen:VARCHAR#,#bomaen:VARCHAR#,#vigaen:VARCHAR#,#posaen:VARCHAR#,#traaen:VARCHAR#,#siaaen:VARCHAR# )
	</insert>

	<update id="updRegByCod" parameterClass="AenVO">
		UPDATE fcn.fcnaen SET 
		proaen = #proaen:VARCHAR#,
		sitaen = #sitaen:VARCHAR#, 
		valaen = #valaen:TIMESTAMP#,
		docaen = UPPER(#docaen:VARCHAR#),
		oriaen = UPPER(#oriaen:VARCHAR#),
		jusaen = UPPER(#jusaen:VARCHAR#),
		obsaen = UPPER(#obsaen:VARCHAR#),
		taxaen = UPPER(#taxaen:VARCHAR#),
		dataen = now(),
		usualt = UPPER(#usualt:VARCHAR#),
		zonaen = #zonaen:VARCHAR#,
		usoaen = #usoaen:VARCHAR#,
		timaen = #timaen:VARCHAR#,
		risaen = #risaen:VARCHAR#,
		ambaen = #ambaen:VARCHAR#,
		bomaen = #bomaen:VARCHAR#,
		vigaen = #vigaen:VARCHAR#,
		posaen = #posaen:VARCHAR#,
		traaen = #traaen:VARCHAR#,
		siaaen = #siaaen:VARCHAR#
		WHERE iddaen = #iddaen:NUMERIC#
	</update>
	
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM fcn.fcnaen WHERE iddaen = #value:NUMERIC#
	</delete>
	
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM fcn.fcnaen WHERE iddaen in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="AenVO"
		resultClass="Integer">
		SELECT count(iddaen) FROM fcn.fcnaen
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddaen" prepend=" AND "> iddaen =
				#iddaen:NUMERIC#
			</isNotNull>
			<isNotNull property="proaen" prepend=" AND "> proaen ilike
				#proaen:VARCHAR#
			</isNotNull>
			<isNotNull property="valaen" prepend=" AND ">
				to_char(valaen,'dd/MM/yyyy') =
				to_char(#valaen:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="docaen" prepend=" AND ">
				docaen ILIKE '%' || #docaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="oriaen" prepend=" AND ">
				oriaen ILIKE '%' || #oriaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="jusaen" prepend=" AND ">
				jusaen ILIKE '%' || #jusaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="obsaen" prepend=" AND ">
				obsaen ILIKE '%' || #obsaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="taxaen" prepend=" AND ">
				taxaen ILIKE '%' || #taxaen:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dataen" prepend=" AND ">
				to_char(dataen,'dd/MM/yyyy') =
				to_char(#dataen:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getIddByProtocolo" parameterClass="String" resultClass="Long">
		select iddaen from fcn.fcnaen aen
		where aen.proaen like #value:VARCHAR#
	</select>
	
	<select id="getQtdAenByUsuario" resultClass="hashmap" parameterClass="String">
		select 
			aen.usualt, count(0) as qtd
		from 
			fcn.fcnaen aen
		where 
			to_char(aen.dataen, 'MM/yyyy') = #value:VARCHAR#
			and usualt not in('SISTEMA')
		group by 1
	</select>
</sqlMap> 
 