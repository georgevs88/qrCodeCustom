<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Njq">
	<typeAlias alias="NjqVO" type="pmcg.imti.domain.NjqVO" />

	<resultMap id="mapComplexQuerySimple" class="NjqVO">
		<result property="iddnjq" column="iddnjq" />
		<result property="njrnjq" column="njrnjq" />
		<result property="qlfnjq" column="qlfnjq" />
		<result property="rlenjq" column="rlenjq" />
		<result property="sadnjq" column="sadnjq" />
		<result property="tpqnjq" column="tpqnjq" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="NjqVO">
		<result property="iddnjq" column="iddnjq" />
		<result property="njrnjq" column="njrnjq" />
		<result property="qlfnjq" column="qlfnjq" />
		<result property="rlenjq" column="rlenjq" />
		<result property="sadnjq" column="sadnjq" />
		<result property="tpqnjq" column="tpqnjq" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM public.fcnnjq WHERE iddnjq = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM public.fcnnjq WHERE iddnjq = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="NjqVO" resultMap="mapComplexQuerySimple">
		SELECT * FROM public.fcnnjq
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddnjq" prepend=" AND ">
				iddnjq = #iddnjq:NUMERIC#
			</isNotNull>
			<isNotNull property="njrnjq" prepend=" AND ">
				njrnjq ILIKE '%' || #njrnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="qlfnjq" prepend=" AND ">
				qlfnjq ILIKE '%' || #qlfnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="rlenjq" prepend=" AND ">
				rlenjq ILIKE '%' || #rlenjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="sadnjq" prepend=" AND ">
				sadnjq ILIKE '%' || #sadnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="tpqnjq" prepend=" AND ">
				tpqnjq ILIKE '%' || #tpqnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="NjqVO" resultMap="mapComplexQuery">
		SELECT * FROM public.fcnnjq
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddnjq" prepend=" AND "> iddnjq = #iddnjq:NUMERIC#
			</isNotNull>
			<isNotNull property="njrnjq" prepend=" AND ">
				njrnjq ILIKE '%' || #njrnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="qlfnjq" prepend=" AND ">
				qlfnjq ILIKE '%' || #qlfnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="rlenjq" prepend=" AND ">
				rlenjq ILIKE '%' || #rlenjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="sadnjq" prepend=" AND ">
				sadnjq ILIKE '%' || #sadnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="tpqnjq" prepend=" AND ">
				tpqnjq ILIKE '%' || #tpqnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM public.fcnnjq
	</select>

	<insert id="insReg" parameterClass="NjqVO">
		<selectKey keyProperty="iddnjq" resultClass="Long">
			SELECT NEXTVAL('public.seqnjq')
		</selectKey>
		INSERT INTO public.fcnnjq(iddnjq,njrnjq,qlfnjq,rlenjq,sadnjq,tpqnjq,usualt,datalt) VALUES (#iddnjq:NUMERIC#,
		UPPER(#njrnjq:VARCHAR#), UPPER(#qlfnjq:VARCHAR#), UPPER(#rlenjq:VARCHAR#), UPPER(#sadnjq:VARCHAR#),
		UPPER(#tpqnjq:VARCHAR#), UPPER(#usualt:VARCHAR#),now() )
	</insert>

	<update id="updRegByCod" parameterClass="NjqVO">
		UPDATE 
			public.fcnnjq 
		SET 
			njrnjq = UPPER(#njrnjq:VARCHAR#),
			qlfnjq = UPPER(#qlfnjq:VARCHAR#),
			rlenjq = UPPER(#rlenjq:VARCHAR#),
			sadnjq = UPPER(#sadnjq:VARCHAR#),
			tpqnjq = UPPER(#tpqnjq:VARCHAR#),
			usualt = UPPER(#usualt:VARCHAR#),
			datalt = now() 
		WHERE 
			iddnjq = #iddnjq:NUMERIC#
	</update>
	
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM public.fcnnjq WHERE iddnjq = #value:NUMERIC#
	</delete>
	
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM public.fcnnjq WHERE iddnjq in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="NjqVO" resultClass="Integer">
		SELECT count(iddnjq) FROM public.fcnnjq
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddnjq" prepend=" AND "> iddnjq = #iddnjq:NUMERIC#
			</isNotNull>
			<isNotNull property="njrnjq" prepend=" AND ">
				njrnjq ILIKE '%' || #njrnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="qlfnjq" prepend=" AND ">
				qlfnjq ILIKE '%' || #qlfnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="rlenjq" prepend=" AND ">
				rlenjq ILIKE '%' || #rlenjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="sadnjq" prepend=" AND ">
				sadnjq ILIKE '%' || #sadnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="tpqnjq" prepend=" AND ">
				tpqnjq ILIKE '%' || #tpqnjq:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getRegByNjrQlf" parameterClass="NjqVO" resultMap="mapComplexQuerySimple">
		select * from public.fcnnjq
		where njrnjq = #njrnjq:VARCHAR#
		and qlfnjq = #qlfnjq:VARCHAR#
		limit 1
	</select>
	
	<select id="getQlfByCon" parameterClass="String" resultClass="String">
		select 
			quacql 
		from 
			public.fcncql
		where 
			cast(concql as varchar) = #value:VARCHAR#
	</select>
</sqlMap> 
 