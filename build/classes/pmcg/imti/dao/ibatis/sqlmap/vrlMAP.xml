<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Sosvrl">
    <typeAlias alias="VrlVO" type="pmcg.imti.domain.VrlVO"/>
    
      <resultMap id="mapComplexQuery" class="VrlVO">
		<result property="codvrl" column="codvrl" />
		<result property="nomvrl" column="nomvrl" />
		<result property="cpfvrl" column="cpfvrl" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
	</resultMap>

    <select id="getRegByCod" parameterClass="Integer" resultClass="VrlVO">
        SELECT *
		  FROM sos.sosvrl
		 WHERE codvrl = #value:NUMERIC#
	</select>
	
	  <select id="getRegByCodComplex" parameterClass="Integer" resultMap="mapComplexQuery">
        SELECT *
		  FROM sos.sosvrl
		 WHERE codvrl = #value:NUMERIC#
	</select>

    <select id="getTodos" resultClass="VrlVO">
        SELECT *
		  FROM sos.sosvrl ORDER BY codvrl
	</select>

    <select id="getRegByCriterio" parameterClass="VrlVO" resultClass="VrlVO">
        SELECT *
		  FROM sos.sosvrl
		<dynamic prepend=" WHERE ">
			<isNotNull property="codvrl" prepend=" AND ">
				codvrl = #codvrl:NUMERIC#
			</isNotNull>
			<isNotNull property="nomvrl" prepend=" AND ">
				UPPER(nomvrl) LIKE '%' || UPPER(#nomvrl:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="cpfvrl" prepend=" AND ">
				UPPER(cpfvrl) LIKE '%' || UPPER(#cpfvrl:VARCHAR#) || '%'
			</isNotNull>
		</dynamic>
	ORDER BY codvrl
	</select>
	
	 <select id="getRegByCriterioComplex" parameterClass="VrlVO" resultMap="mapComplexQuery">
        SELECT *
		  FROM sos.sosvrl
		<dynamic prepend=" WHERE ">
			<isNotNull property="codvrl" prepend=" AND ">
				codvrl = #codvrl:NUMERIC#
			</isNotNull>
			<isNotNull property="nomvrl" prepend=" AND ">
				UPPER(nomvrl) LIKE '%' || UPPER(#nomvrl:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="cpfvrl" prepend=" AND ">
				UPPER(cpfvrl) LIKE '%' || UPPER(#cpfvrl:VARCHAR#) || '%'
			</isNotNull>
		</dynamic>
	ORDER BY codvrl
	</select>

    <insert id="insReg" parameterClass="VrlVO">
        <selectKey keyProperty="codvrl" resultClass="Integer">
			select nextval('sos.sosvrl_codvrl_seq') as codvrl
		</selectKey>

		INSERT INTO sos.sosvrl (codvrl, nomvrl, cpfvrl,usualt, datalt)
				VALUES (#codvrl:NUMERIC#, UPPER(#nomvrl:VARCHAR#), #cpfvrl:VARCHAR#, #usualt:VARCHAR#, now() )
	</insert>

    <update id="updRegByCod" parameterClass="VrlVO">
        UPDATE sos.sosvrl
		   SET nomvrl = UPPER(#nomvrl:VARCHAR#),
			 cpfvrl = #cpfvrl:VARCHAR#,
			 usualt=#usualt:VARCHAR#,
			 datalt=now()
		 WHERE codvrl = #codvrl:NUMERIC#
    </update>

    <delete id="delByCod" parameterClass="Integer">
        DELETE FROM sos.sosvrl
		 WHERE codvrl = #value:NUMERIC#
    </delete>
    
        <select id="countRegByCriterio" parameterClass="VrlVO" resultClass="Integer">
        SELECT  count(*)
		  FROM sos.sosvrl
		<dynamic prepend=" WHERE ">
			<isNotNull property="codvrl" prepend=" AND ">
				codvrl = #codvrl:NUMERIC#
			</isNotNull>
			<isNotNull property="nomvrl" prepend=" AND ">
				UPPER(nomvrl) LIKE '%' || UPPER(#nomvrl:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="cpfvrl" prepend=" AND ">
				UPPER(cpfvrl) LIKE '%' || UPPER(#cpfvrl:VARCHAR#) || '%'
			</isNotNull>
		</dynamic>
	</select>
	
	
	  <select id="countCPF" parameterClass="VrlVO" resultClass="Integer">
        SELECT count(*)
		  FROM sos.sosvrl
			WHERE cpfvrl=#cpfvrl:VARCHAR#
				<isNotNull property="codvrl" prepend="AND">
			codvrl != #codvrl:NUMERIC#
		</isNotNull>
	</select>
	<select id="getRegByCpf" parameterClass="String" resultClass="VrlVO">
        SELECT *
		  	FROM sos.sosvrl
		WHERE	
			cpfvrl = #value:VARCHAR#
			
	</select>

</sqlMap>
