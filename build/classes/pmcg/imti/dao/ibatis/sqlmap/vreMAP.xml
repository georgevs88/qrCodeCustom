<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Sosvre">
    <typeAlias alias="VreVO" type="pmcg.imti.domain.VreVO"/>

	 <resultMap id="mapComplexQuery" class="VreVO">
		<result property="codvre" column="codvre" />
		<result property="codvrl" column="codvrl" />
		<result property="codves" column="codves" />
		<result property="datini" column="datini" />
		<result property="datfim" column="datfim" />
		<result property="codcar" column="codcar" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
		<result property="privre" column="privre" />
		<result property="carVO" select="Soscar.getRegByCod" column="codcar" />
		<result property="vesVO" select="Ves.getRegByCod" column="codves" />
		<result property="vrlVO" select="Sosvrl.getRegByCod" column="codvrl" />
	</resultMap>

    <select id="getRegByCod" parameterClass="Integer" resultClass="VreVO">
        SELECT *
		  FROM sos.sosvre
		 WHERE codvre = #value:NUMERIC#
	</select>
	
	 <select id="getRegByCodComplex" parameterClass="Integer" resultMap="mapComplexQuery">
        SELECT *
		  FROM sos.sosvre
		 WHERE codvre = #value:NUMERIC#
	</select>

    <select id="getTodos" resultClass="VreVO">
        SELECT *
		  FROM sos.sosvre ORDER BY codvre
	</select>

    <select id="getRegByCriterio" parameterClass="VreVO" resultClass="VreVO">
        SELECT *
		  FROM sos.sosvre
		<dynamic prepend=" WHERE ">
			<isNotNull property="codvre" prepend=" AND ">
				codvre = #codvre:NUMERIC#
			</isNotNull>
			<isNotNull property="codvrl" prepend=" AND ">
				codvrl = #codvrl:NUMERIC#
			</isNotNull>
			<isNotNull property="codves" prepend=" AND ">
				codves = #codves:NUMERIC#
			</isNotNull>
			<isNotNull property="datini" prepend=" AND ">
				datini = #datini:TIMESTAMP#
			</isNotNull>
			<isNotNull property="datfim" prepend=" AND ">
				datfim = #datfim:TIMESTAMP#
			</isNotNull>
			<isNotNull property="codcar" prepend=" AND ">
				codcar = #codcar:NUMERIC#
			</isNotNull>
			<isNotNull property="privre" prepend=" AND ">
				privre = #privre:BOOLEAN#
			</isNotNull>
			
		</dynamic>
	ORDER BY codvre
	</select>
	
	
	  <select id="getRegByCriterioComplex" parameterClass="VreVO" resultMap="mapComplexQuery">
        SELECT *
		  FROM sos.sosvre
		<dynamic prepend=" WHERE ">
			<isNotNull property="codvre" prepend=" AND ">
				codvre = #codvre:NUMERIC#
			</isNotNull>
			<isNotNull property="codvrl" prepend=" AND ">
				codvrl = #codvrl:NUMERIC#
			</isNotNull>
			<isNotNull property="codves" prepend=" AND ">
				codves = #codves:NUMERIC#
			</isNotNull>
			<isNotNull property="datini" prepend=" AND ">
				datini = #datini:TIMESTAMP#
			</isNotNull>
			<isNotNull property="datfim" prepend=" AND ">
				datfim = #datfim:TIMESTAMP#
			</isNotNull>
			<isNotNull property="codcar" prepend=" AND ">
				codcar = #codcar:NUMERIC#
			</isNotNull>
			<isNotNull property="privre" prepend=" AND ">
				privre = #privre:BOOLEAN#
			</isNotNull>
			
		</dynamic>
	ORDER BY codvre
	</select>
	

    <insert id="insReg" parameterClass="VreVO">
        <selectKey keyProperty="codvre" resultClass="Integer">
			select nextval('sos.sosvre_codvre_seq') as codvre
		</selectKey>

		INSERT INTO sos.sosvre (codvre, codvrl, codves, datini, datfim, codcar,usualt, datalt, privre)
				VALUES (#codvre:NUMERIC#, #codvrl:NUMERIC#, #codves:NUMERIC#, #datini:TIMESTAMP#, #datfim:TIMESTAMP#, #codcar:NUMERIC#, #usualt:VARCHAR#, now(), #privre:BOOLEAN#)
	</insert>

    <update id="updRegByCod" parameterClass="VreVO">
        UPDATE sos.sosvre
		   SET codvrl = #codvrl:NUMERIC#,
			 codves = #codves:NUMERIC#,
			 datini = #datini:TIMESTAMP#,
			 datfim = #datfim:TIMESTAMP#,
			 codcar = #codcar:NUMERIC#,
			 usualt=#usualt:VARCHAR#,
			 datalt=now(),
			 privre = #privre:BOOLEAN#
		 WHERE codvre = #codvre:NUMERIC#
    </update>

    <delete id="delByCod" parameterClass="Integer">
        DELETE FROM sos.sosvre
		 WHERE codvre = #value:NUMERIC#
    </delete>

 <select id="countRegByCriterio" parameterClass="VreVO" resultClass="Integer">
        SELECT count(*)
		  FROM sos.sosvre
		<dynamic prepend=" WHERE ">
			<isNotNull property="codvre" prepend=" AND ">
				codvre = #codvre:NUMERIC#
			</isNotNull>
			<isNotNull property="codvrl" prepend=" AND ">
				codvrl = #codvrl:NUMERIC#
			</isNotNull>
			<isNotNull property="codves" prepend=" AND ">
				codves = #codves:NUMERIC#
			</isNotNull>
			<isNotNull property="datini" prepend=" AND ">
				datini = #datini:TIMESTAMP#
			</isNotNull>
			<isNotNull property="datfim" prepend=" AND ">
				datfim = #datfim:TIMESTAMP#
			</isNotNull>
			<isNotNull property="codcar" prepend=" AND ">
				codcar = #codcar:NUMERIC#
			</isNotNull>
			<isNotNull property="privre" prepend=" AND ">
				privre = #privre:BOOLEAN#
			</isNotNull>			
		</dynamic>
	</select>

</sqlMap>
