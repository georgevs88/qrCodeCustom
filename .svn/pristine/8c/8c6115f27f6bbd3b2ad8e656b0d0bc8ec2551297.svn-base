<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Sin">
	<typeAlias alias="SinVO" type="pmcg.imti.domain.SinVO" />

	<resultMap id="mapComplexQuerySimple" class="SinVO">
		<result property="codsin" column="codsin" />
		<result property="sigla" column="sigla" />
		<result property="nomcom" column="nomcom" />
		<result property="datfim" column="datfim" />
		<result property="datalt" column="datalt" />
		<result property="codusualt" column="codusualt" />
		<result property="numver" column="numver" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="SinVO">
		<result property="codsin" column="codsin" />
		<result property="sigla" column="sigla" />
		<result property="nomcom" column="nomcom" />
		<result property="datfim" column="datfim" />
		<result property="datalt" column="datalt" />
		<result property="codusualt" column="codusualt" />
		<result property="numver" column="numver" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Integer" resultMap="mapComplexQuerySimple">
		SELECT * FROM siatcgr.tblsin WHERE codsin = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Integer" resultMap="mapComplexQuery">
		SELECT * FROM siatcgr.tblsin WHERE codsin = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="SinVO" resultMap="mapComplexQuerySimple">
		SELECT * FROM siatcgr.tblsin
		<dynamic prepend=" WHERE ">
			<isNotNull property="codsin" prepend=" AND ">
				codsin = #codsin:NUMERIC#
			</isNotNull>
			<isNotNull property="sigla" prepend=" AND ">
				UPPER(sigla) LIKE '%' || UPPER(#sigla:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="nomcom" prepend=" AND ">
				UPPER(nomcom) LIKE '%' || UPPER(#nomcom:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="datfim" prepend=" AND "> to_char(datfim,'dd/MM/yyyy') =
				to_char(#datfim:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="codusualt" prepend=" AND ">
				UPPER(codusualt) LIKE '%' || UPPER(#codusualt:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="numver" prepend=" AND ">
				numver = #numver:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="SinVO" resultMap="mapComplexQuery">
		SELECT * FROM siatcgr.tblsin
		<dynamic prepend=" WHERE ">
			<isNotNull property="codsin" prepend=" AND "> codsin = #codsin:NUMERIC#
			</isNotNull>
			<isNotNull property="sigla" prepend=" AND ">
				UPPER(sigla) LIKE '%' || UPPER(#sigla:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="nomcom" prepend=" AND ">
				UPPER(nomcom) LIKE '%' || UPPER(#nomcom:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="datfim" prepend=" AND "> to_char(datfim,'dd/MM/yyyy') =
				to_char(#datfim:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="codusualt" prepend=" AND ">
				UPPER(codusualt) LIKE '%' || UPPER(#codusualt:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="numver" prepend=" AND "> numver = #numver:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM siatcgr.tblsin
		ORDER BY sigla
	</select>

	<insert id="insReg" parameterClass="SinVO">
		<selectKey keyProperty="codsin" resultClass="Integer">
			SELECT siatcgr.seqsin.nextval from dual
		</selectKey>
		INSERT INTO siatcgr.tblsin(codsin,sigla,nomcom,datfim,datalt,codusualt,numver) VALUES (#codsin:NUMERIC#,
		UPPER(#sigla:VARCHAR#), UPPER(#nomcom:VARCHAR#),#datfim:TIMESTAMP#,sysdate,
		UPPER(#codusualt:VARCHAR#),#numver:NUMERIC# )
	</insert>

	<update id="updRegByCod" parameterClass="SinVO">
		UPDATE siatcgr.tblsin SET sigla= UPPER(#sigla:VARCHAR#),nomcom= UPPER(#nomcom:VARCHAR#),datfim= #datfim:TIMESTAMP#,datalt=
		sysdate,codusualt= UPPER(#codusualt:VARCHAR#),numver= #numver:NUMERIC# WHERE codsin = #codsin:NUMERIC#
	</update>
	
	<delete id="delByCod" parameterClass="Integer">
		DELETE FROM siatcgr.tblsin WHERE codsin = #value:NUMERIC#
	</delete>
	
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM siatcgr.tblsin WHERE codsin in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="SinVO" resultClass="Integer">
		SELECT count(codsin) FROM siatcgr.tblsin
		<dynamic prepend=" WHERE ">
			<isNotNull property="codsin" prepend=" AND "> codsin = #codsin:NUMERIC#
			</isNotNull>
			<isNotNull property="sigla" prepend=" AND ">
				UPPER(sigla) LIKE '%' || UPPER(#sigla:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="nomcom" prepend=" AND ">
				UPPER(nomcom) LIKE '%' || UPPER(#nomcom:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="datfim" prepend=" AND "> to_char(datfim,'dd/MM/yyyy') =
				to_char(#datfim:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="codusualt" prepend=" AND ">
				UPPER(codusualt) LIKE '%' || UPPER(#codusualt:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="numver" prepend=" AND "> numver = #numver:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getSinBySigla" parameterClass="String" resultMap="mapComplexQuerySimple">
		SELECT * FROM siatcgr.tblsin
		where SIGLA = #value:VARCHAR#
	</select>
</sqlMap> 
 