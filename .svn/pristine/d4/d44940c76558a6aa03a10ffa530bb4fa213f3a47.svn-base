package pmcg.imti.view;

import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

import org.zkoss.zul.Messagebox;

import pmcg.fcn.dao.ibatis.CfgDAO;
import pmcg.fcn.dao.ibatis.TabDAO;
import pmcg.fcn.domain.CfgVO;
import pmcg.fcn.domain.TabVO;
import pmcg.framework.ui.WindowCrud;
import pmcg.imti.dao.ibatis.UsuDAO;
import pmcg.imti.domain.UsuVO;

public class Cmacad extends WindowCrud{
	private static final long serialVersionUID = 1L;
	public String nomeOrgao;
	public String siglaOrgao;
	public String nomeDivisao;
	public String siglaDivisao;
	public String siglasDivisao;
	public List<UsuVO> listUsu;
	public UsuVO usuSelRel;
	public UsuVO usuSelLic;
	public TabVO cargoRel;
	public TabVO cargoLic;
	public CfgVO cfgVO = new CfgVO();
	public List<TabVO> listCargo = new ArrayList<TabVO>(); //Lista de cargos
	
	public void initComponentes() throws InterruptedException, SQLException{
		listUsu = new UsuDAO().getTodos(null);
		getCrdBar().getBotao(0).setVisible(false);
		getCrdBar().getBotao(1).setVisible(true);
		getCrdBar().getBotao(2).setVisible(false);
		getCrdBar().getBotao(3).setVisible(false);
		getCrdBar().getBotao(4).setVisible(false);
		getCrdBar().getBotao(5).setVisible(false);
		getCrdBar().getBotao(6).setVisible(true);
		listCargo = new TabDAO().getRegByTipo("CARGO_MA");
		nomeOrgao = new CfgDAO().getValorByParam("NOME_ORGAO_MA");
		siglaOrgao = new CfgDAO().getValorByParam("SIGLA_ORGAO_MA");
		nomeDivisao = new CfgDAO().getValorByParam("NOME_DIVISAO_MA");
		siglaDivisao = new CfgDAO().getValorByParam("SIGLA_DIVISAO_MA");
		siglasDivisao = new CfgDAO().getValorByParam("SIGLAS_DIVISAO_MA");
		String codusurel = new CfgDAO().getValorByParam("CODUSU_RESP_REL_MA");
		usuSelRel = new UsuDAO().getRegByCod(Long.parseLong(codusurel));
		String CARGO_RESP_REL_MA = new CfgDAO().getValorByParam("CARGO_RESP_REL_MA");
		TabVO tab = new TabVO();
		tab.setDestab(CARGO_RESP_REL_MA);
		cargoRel = (new TabDAO().getRegByCriterio(tab)).get(0);
		String codusulic = new CfgDAO().getValorByParam("CODUSU_RESP_LIC_MA");
		usuSelLic = new UsuDAO().getRegByCod(Long.parseLong(codusulic));
		String CARGO_RESP_LIC_MA = new CfgDAO().getValorByParam("CARGO_RESP_LIC_MA");
		tab.setDestab(CARGO_RESP_LIC_MA);
		cargoLic = (new TabDAO().getRegByCriterio(tab)).get(0);
		vincular();
	}
	
	@Override
	public void salvar() throws InterruptedException {
		if (Messagebox.show("Tem certeza que deseja Salvar as Comnfigurações?","Aviso!!!", Messagebox.YES | Messagebox.NO, Messagebox.QUESTION) == Messagebox.YES) {
			try {
				HashMap<String, Object> param = new HashMap<String, Object>();
				param.put("parcfg", "NOME_ORGAO_MA");
				param.put("valcfg", nomeOrgao);
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "SIGLA_ORGAO_MA");
				param.put("valcfg", siglaOrgao);
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "NOME_DIVISAO_MA");
				param.put("valcfg", nomeDivisao);
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "SIGLA_DIVISAO_MA");
				param.put("valcfg", siglaDivisao);
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "SIGLAS_DIVISAO_MA");
				param.put("valcfg", siglasDivisao);
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "CODUSU_RESP_REL_MA");
				param.put("valcfg", usuSelRel.getCodusu().toString());
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "CARGO_RESP_REL_MA");
				param.put("valcfg", cargoRel.getDestab());
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "CODUSU_RESP_LIC_MA");
				param.put("valcfg", usuSelLic.getCodusu().toString());
				new CfgDAO().updValByPar(param);
				
				param.put("parcfg", "CARGO_RESP_LIC_MA");
				param.put("valcfg", cargoLic.getDestab());
				new CfgDAO().updValByPar(param);
				Messagebox.show("Configuração salva com sucesso!");
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
	}
	
	
	public void pesquisar() {
	}
	
	@Override
	public void incluir() throws InterruptedException {
		
	}

	@Override
	public void apagar() throws InterruptedException {
	}

	@Override
	public void limpar() throws InterruptedException {
		vincular();
	}

	@Override
	public void imprimir() throws InterruptedException {
		
	}

	@Override
	public void sair() throws InterruptedException {
		detach();
	}
	
}
