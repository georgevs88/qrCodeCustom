<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Zon">
	<typeAlias alias="ZonVO" type="pmcg.fcn.domain.ZonVO" />


	<resultMap id="mapComplexQuerySimple" class="ZonVO">
		<result property="iddzon" column="iddzon" />
		<result property="codzon" column="codzon" />
		<result property="deszon" column="deszon" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="ZonVO">
		<result property="iddzon" column="iddzon" />
		<result property="codzon" column="codzon" />
		<result property="deszon" column="deszon" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnzon WHERE iddzon = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnzon WHERE iddzon = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="ZonVO" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnzon
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddzon" prepend=" AND ">
				iddzon = #iddzon:NUMERIC#
			</isNotNull>
			<isNotNull property="codzon" prepend=" AND ">
				codzon ILIKE '%' || #codzon:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="deszon" prepend=" AND ">
				deszon ILIKE '%' || #deszon:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="ZonVO" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnzon
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddzon" prepend=" AND "> iddzon = #iddzon:NUMERIC#
			</isNotNull>
			<isNotNull property="codzon" prepend=" AND ">
				codzon ILIKE '%' || #codzon:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="deszon" prepend=" AND ">
				deszon ILIKE '%' || #deszon:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnzon
	</select>

	<insert id="insReg" parameterClass="ZonVO">
		<selectKey keyProperty="iddzon" resultClass="Long">
			SELECT NEXTVAL('fcn.seqzon')
		</selectKey>
		INSERT INTO fcn.fcnzon(iddzon,codzon,deszon,usualt,datalt) VALUES (#iddzon:NUMERIC#, UPPER(#codzon:VARCHAR#),
		UPPER(#deszon:VARCHAR#), UPPER(#usualt:VARCHAR#),now() )
	</insert>

	<update id="updRegByCod" parameterClass="ZonVO">
		UPDATE fcn.fcnzon SET codzon= UPPER(#codzon:VARCHAR#),deszon= UPPER(#deszon:VARCHAR#),usualt= UPPER(#usualt:VARCHAR#),datalt=
		now() WHERE iddzon = #iddzon:NUMERIC#
	</update>
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM fcn.fcnzon WHERE iddzon = #value:NUMERIC#
	</delete>
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM fcn.fcnzon WHERE iddzon in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="ZonVO" resultClass="Integer">
		SELECT count(iddzon) FROM fcn.fcnzon
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddzon" prepend=" AND "> iddzon = #iddzon:NUMERIC#
			</isNotNull>
			<isNotNull property="codzon" prepend=" AND ">
				codzon ILIKE '%' || #codzon:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="deszon" prepend=" AND ">
				deszon ILIKE '%' || #deszon:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getZonNaoCad" resultMap="mapComplexQuerySimple" parameterClass="String">
		SELECT * from fcn.fcnzon Z 
		WHERE Z.codzon NOT IN(
							select 
								ZON.codzon 
							from 
								fcn.fcnzon ZON 
								JOIN fcn.fcnzim ZIM ON ZON.codzon = ZIM.zonzim
							WHERE 
								ZIM.imozim = #value:VARCHAR#)	
		order by LENGTH(Z.codzon), Z.codzon
	</select>
</sqlMap> 
 