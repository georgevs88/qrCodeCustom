<?page title="Gráfico" contentType="text/html;charset=UTF-8"?>
<?link rel="shortcut icon" type="image/png" href="images/externo/brasaoPref01.png"?>
<?link href="/css/bootstrap.min.css" rel="stylesheet"?>
<?meta name="keywords" content="integrar" ?>
<zk:zk xmlns="http://www.zkoss.org/2005/zk/native"
xmlns:zul="http://www.zkoss.org/2005/zul"
xmlns:zk="http://www.zkoss.org/2005/zk"
xmlns:h="http://www.w3.org/1999/xhtml">
<zul:window use="pmcg.imti.view.Graph" id="wGra" border="none" width="800px" height="570px"
		position="center" mode="overlapped" sizable="true" closable="false" onCreate="wGra.initComponentes()">
	<script type="text/javascript" src="/integrarweb/js/Chart.min.js"></script>
	<script type="text/javascript">
		<![CDATA[
			function carregaGraficoLinha(labelsX, dados, tipoGrafico, labelsLegenda, curva){
				var labelsXArray = labelsX.split('|');
				var dadosArray = dados.split(',');
				if (dadosArray.length > 2) {
					var colors = ["rgba(48,63,159,","rgba(0,188,212,","rgba(117,117,117,","rgba(255,235,59,","rgba(76,175,80,","rgba(255,160,0,","rgba(255,87,34,","rgba(121,85,72,","rgba(156,39,176,","rgba(236,64,122,"];
				} else {
					var colors = ["rgba(220,220,220,","rgba(151,187,205,"];
				}
				var labelsLegendaXArray = labelsLegenda.split('|');
				
				var options = {
			            responsive:true,
			            bezierCurve:curva
			    };
				
				var data;
				if (dadosArray.length > 0) {
					data = {
				            labels: labelsXArray,
				            datasets: [
				            	{
				                    label: "Ano referência",
				                    fillColor: colors[0] + "0.2)",
				                    strokeColor: colors[0] + "1)",
				                    pointColor: colors[0] + "1)",
				                    pointStrokeColor: "#fff",
				                    pointHighlightFill: "#fff",
				                    pointHighlightStroke: colors[0] + "1)",
				                    data: dadosArray[0].split('|')
				                }
				            ]
				    	}; 
					if (dadosArray.length > 1) { 
 						for (var i = 1; i < dadosArray.length; i++) { 
 							data.datasets.push( 
								{ 
				                    label: "Ano comparar", 
				                    fillColor: colors[i] + "0.2)",
		                            strokeColor: colors[i] + "1)",
		                            pointColor: colors[i] + "1)",
				                    pointStrokeColor: "#fff", 
				                    pointHighlightFill: "#fff", 
				                    pointHighlightStroke: colors[i] + "1)",
				                    data: dadosArray[i].split('|') 
				                }
							 ); 
 						}                  
 					} 
				}
				     
			    var ctx = document.getElementById("Grafico").getContext("2d");
			    if (tipoGrafico == 'LINHA') {
					var LineChart = new Chart(ctx).Line(data, options);
			    } else {
			    	var LineChart = new Chart(ctx).Bar(data, options);
			    }
				
			    var legenda = document.getElementById("legenda");
				var htmlLegenda = "<ul class=\"doughnut-legend\">";
 				for (var i = 0; i < dadosArray.length; i++) { 
 					htmlLegenda = htmlLegenda + "<li style=\"display: inline;margin-left: 5px;\"><span style=\"background-color:" + colors[i] + "1)\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>" + labelsLegendaXArray[i] + "</li>";
 				} 
 				htmlLegenda = htmlLegenda + "</ul>";
				legenda.innerHTML = htmlLegenda;
			} 
			
			function carregaGraficoDonut(labelsDados, dados, tipoGrafico){
				var labelsDadosArray = labelsDados.split('|');
				var dadosArray = dados.split(',');				
				var data;
				var colors = ["rgba(48,63,159,","rgba(0,188,212,","rgba(117,117,117,","rgba(255,235,59,","rgba(76,175,80,","rgba(255,160,0,","rgba(255,87,34,","rgba(121,85,72,","rgba(156,39,176,","rgba(236,64,122,"];
				
				var options = {responsive:true};
		
				if (dadosArray.length > 0) {
					data = [ 
						{
					    	value: parseFloat(dadosArray[0]),
					        color: colors[0] + "1)",
					        highlight: colors[0] + "0.7)",
					        label: labelsDadosArray[0] 
						}];  
					if (dadosArray.length > 1) {
						for (var i = 1; i < dadosArray.length; i++) {
							data.push(
								{
									value: parseFloat(dadosArray[i]),
								    color: colors[i] + "1)",
								    highlight: colors[i] + "0.7)",
								    label: labelsDadosArray[i] 
								}
							);
						}                 
					}
				} 
				var ctx = document.getElementById("Grafico").getContext("2d");
				var grafico;	
				if (tipoGrafico == 'PIZZA') {
					grafico = new Chart(ctx).Pie(data, options);
				} else {
					grafico = new Chart(ctx).Doughnut(data, options);
				}
			    
				var legenda = document.getElementById("legenda");
				var htmlLegenda = "<ul class=\"doughnut-legend\">";
 				for (var i = 0; i < labelsDadosArray.length; i++) { 
 					htmlLegenda = htmlLegenda + "<li style=\"display: inline;margin-left: 5px;\"><span style=\"background-color:" + colors[i] + "1)\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>" + labelsDadosArray[i] + "</li>";
 				} 
 				htmlLegenda = htmlLegenda + "</ul>";
 				legenda.innerHTML = htmlLegenda;
			}  
		]]>
	</script>
	<div align="center" style="margin-top: 10px;">
		<zul:label id="titulo" value="@{wGra.titulo}" style="font-size:22px;font-weight:bold;"/>
	</div>
	<html>	
		<div id="legenda" style="margin-top: 5px;width:797px;" width="200px"></div>
	</html>
	<label value="Título" style="font-size:20px;font-weight:bold;"/>
	<div align="center">
		<html>	
			<canvas id="Grafico" width="500px" height="270px"></canvas>
		</html>
		<zul:button class="btn btn-lg btn-default" style="margin-top:5px;" label="Fechar" onClick="wGra.sair()"/>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="/integrarweb/js/bootstrap.min.js"></script>
</zul:window>
</zk:zk>
