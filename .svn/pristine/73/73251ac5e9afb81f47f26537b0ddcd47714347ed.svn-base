<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Lma">
	<typeAlias alias="LmaVO" type="pmcg.fcn.domain.LmaVO" />

	<resultMap id="mapComplexQuerySimple" class="LmaVO">
		<result property="iddlma" column="iddlma" />
		<result property="numlma" column="numlma" />
		<result property="esplma" column="esplma" />
		<result property="prolma" column="prolma" />
		<result property="emilma" column="emilma" />
		<result property="vallma" column="vallma" />
		<result property="reqlma" column="reqlma" />
		<result property="atvlma" column="atvlma" />
		<result property="edrlma" column="edrlma" />
		<result property="reglma" column="reglma" />
		<result property="analma" column="analma" />
		<result property="anclma" column="anclma" />
		<result property="elalma" column="elalma" />
		<result property="obslma" column="obslma" />
		<result property="anolma" column="anolma" />
		<result property="asslma" column="asslma" />
		<result property="muslma" column="muslma" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
		<result property="sitlma" column="sitlma" />
		<result property="cpflma" column="cpflma" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="LmaVO">
		<result property="iddlma" column="iddlma" />
		<result property="numlma" column="numlma" />
		<result property="esplma" column="esplma" />
		<result property="prolma" column="prolma" />
		<result property="emilma" column="emilma" />
		<result property="vallma" column="vallma" />
		<result property="reqlma" column="reqlma" />
		<result property="atvlma" column="atvlma" />
		<result property="edrlma" column="edrlma" />
		<result property="reglma" column="reglma" />
		<result property="analma" column="analma" />
		<result property="anclma" column="anclma" />
		<result property="elalma" column="elalma" />
		<result property="obslma" column="obslma" />
		<result property="anolma" column="anolma" />
		<result property="asslma" column="asslma" />
		<result property="muslma" column="muslma" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
		<result property="sitlma" column="sitlma" />
		<result property="cpflma" column="cpflma" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM lic.liclma WHERE iddlma = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM lic.liclma WHERE iddlma =
		#value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="LmaVO" resultMap="mapComplexQuerySimple">
		SELECT * FROM lic.liclma
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddlma" prepend=" AND ">
				iddlma = #iddlma:NUMERIC#
			</isNotNull>
			<isNotNull property="numlma" prepend=" AND ">
				numlma = #numlma:NUMERIC#
			</isNotNull>
			<isNotNull property="esplma" prepend=" AND ">
				esplma ILIKE '%' || #esplma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="prolma" prepend=" AND ">
				prolma ILIKE '%' || #prolma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="emilma" prepend=" AND "> 
				emilma = #emilma:TIMESTAMP#
			</isNotNull>
			<isNotNull property="vallma" prepend=" AND "> to_char(vallma,'dd/MM/yyyy') =
				to_char(#vallma:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="reqlma" prepend=" AND ">
				reqlma ILIKE '%' || #reqlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="atvlma" prepend=" AND ">
				atvlma ILIKE '%' || #atvlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="edrlma" prepend=" AND ">
				edrlma ILIKE '%' || #edrlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="reglma" prepend=" AND ">
				reglma ILIKE '%' || #reglma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="analma" prepend=" AND ">
				analma ILIKE '%' || #analma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="elalma" prepend=" AND ">
				elalma ILIKE '%' || #elalma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="obslma" prepend=" AND ">
				obslma ILIKE '%' || #obslma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="anolma" prepend=" AND ">
				anolma = #anolma:NUMERIC#
			</isNotNull>
			<isNotNull property="asslma" prepend=" AND ">
				asslma ILIKE '%' || #asslma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="muslma" prepend=" AND "> muslma = #muslma#
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
		order by emilma desc, numlma desc
	</select>

	<select id="getRegByCriterioComplex" parameterClass="LmaVO" resultMap="mapComplexQuery">
		SELECT * FROM lic.liclma
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddlma" prepend=" AND "> iddlma = #iddlma:NUMERIC#
			</isNotNull>
			<isNotNull property="numlma" prepend=" AND "> numlma = #numlma:NUMERIC#
			</isNotNull>
			<isNotNull property="esplma" prepend=" AND ">
				esplma ILIKE '%' || #esplma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="prolma" prepend=" AND ">
				prolma ILIKE '%' || #prolma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="emilma" prepend=" AND "> 
				emilma = #emilma:TIMESTAMP#
			</isNotNull>
			<isNotNull property="vallma" prepend=" AND "> to_char(vallma,'dd/MM/yyyy') =
				to_char(#vallma:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="reqlma" prepend=" AND ">
				reqlma ILIKE '%' || #reqlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="atvlma" prepend=" AND ">
				atvlma ILIKE '%' || #atvlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="edrlma" prepend=" AND ">
				edrlma ILIKE '%' || #edrlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="reglma" prepend=" AND ">
				reglma ILIKE '%' || #reglma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="analma" prepend=" AND ">
				analma ILIKE '%' || #analma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="elalma" prepend=" AND ">
				elalma ILIKE '%' || #elalma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="obslma" prepend=" AND ">
				obslma ILIKE '%' || #obslma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="anolma" prepend=" AND "> anolma = #anolma:NUMERIC#
			</isNotNull>
			<isNotNull property="asslma" prepend=" AND ">
				asslma ILIKE '%' || #asslma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="muslma" prepend=" AND "> muslma = #muslma#
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM lic.liclma
	</select>

	<insert id="insReg" parameterClass="LmaVO">
		<selectKey keyProperty="iddlma" resultClass="Long">
			SELECT NEXTVAL('lic.seqlma')
		</selectKey>
		INSERT INTO
		lic.liclma(iddlma,numlma,esplma,prolma,emilma,vallma,reqlma,atvlma,edrlma,reglma,analma,elalma,obslma,anolma,asslma,muslma,usualt,datalt,anclma,sitlma,cpflma)
		VALUES (#iddlma:NUMERIC#,lic.gera_numlma(#esplma:VARCHAR#, #anolma:NUMERIC#), UPPER(#esplma:VARCHAR#),
		UPPER(#prolma:VARCHAR#),now(),#vallma:TIMESTAMP#, UPPER(#reqlma:VARCHAR#), UPPER(#atvlma:VARCHAR#),
		UPPER(#edrlma:VARCHAR#), UPPER(#reglma:VARCHAR#), UPPER(#analma:VARCHAR#), UPPER(#elalma:VARCHAR#),
		UPPER(#obslma:VARCHAR#),#anolma:NUMERIC#, UPPER(#asslma:VARCHAR#),#muslma#, UPPER(#usualt:VARCHAR#),now(),UPPER(#anclma:VARCHAR#),#sitlma:VARCHAR#,#cpflma:VARCHAR# )
	</insert>

	<update id="updRegByCod" parameterClass="LmaVO">
		UPDATE 
			lic.liclma 
		SET 
			numlma = #numlma:NUMERIC#,
			esplma = UPPER(#esplma:VARCHAR#),
			prolma = UPPER(#prolma:VARCHAR#),
			emilma = #emilma:TIMESTAMP#,
			vallma = #vallma:TIMESTAMP#,
			reqlma = UPPER(#reqlma:VARCHAR#),
			atvlma = UPPER(#atvlma:VARCHAR#),
			edrlma = UPPER(#edrlma:VARCHAR#),
			reglma = UPPER(#reglma:VARCHAR#),
			analma = UPPER(#analma:VARCHAR#),
			elalma = UPPER(#elalma:VARCHAR#),
			obslma = UPPER(#obslma:VARCHAR#),
			anolma = #anolma:NUMERIC#,
			asslma = UPPER(#asslma:VARCHAR#),
			muslma = #muslma#,
			usualt = UPPER(#usualt:VARCHAR#),
			datalt = now(),
			anclma = UPPER(#anclma:VARCHAR#),
			sitlma = #sitlma:VARCHAR#,
			cpflma = #cpflma:VARCHAR#
		WHERE 
			iddlma = #iddlma:NUMERIC#
	</update>

	<delete id="delByCod" parameterClass="Long">
		DELETE FROM lic.liclma WHERE iddlma = #value:NUMERIC#
	</delete>

	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM lic.liclma WHERE iddlma in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="LmaVO" resultClass="Integer">
		SELECT count(iddlma) FROM lic.liclma
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddlma" prepend=" AND "> iddlma = #iddlma:NUMERIC#
			</isNotNull>
			<isNotNull property="numlma" prepend=" AND "> numlma = #numlma:NUMERIC#
			</isNotNull>
			<isNotNull property="esplma" prepend=" AND ">
				esplma ILIKE '%' || #esplma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="prolma" prepend=" AND ">
				prolma ILIKE '%' || #prolma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="emilma" prepend=" AND "> 
				emilma = #emilma:TIMESTAMP#
			</isNotNull>
			<isNotNull property="vallma" prepend=" AND "> to_char(vallma,'dd/MM/yyyy') =
				to_char(#vallma:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="reqlma" prepend=" AND ">
				reqlma ILIKE '%' || #reqlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="atvlma" prepend=" AND ">
				atvlma ILIKE '%' || #atvlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="edrlma" prepend=" AND ">
				edrlma ILIKE '%' || #edrlma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="reglma" prepend=" AND ">
				reglma ILIKE '%' || #reglma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="analma" prepend=" AND ">
				analma ILIKE '%' || #analma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="elalma" prepend=" AND ">
				elalma ILIKE '%' || #elalma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="obslma" prepend=" AND ">
				obslma ILIKE '%' || #obslma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="anolma" prepend=" AND "> anolma = #anolma:NUMERIC#
			</isNotNull>
			<isNotNull property="asslma" prepend=" AND ">
				asslma ILIKE '%' || #asslma:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="muslma" prepend=" AND "> muslma = #muslma#
			</isNotNull>
			<isNotNull property="usualt" prepend=" AND ">
				usualt ILIKE '%' || #usualt:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="datalt" prepend=" AND "> to_char(datalt,'dd/MM/yyyy') =
				to_char(#datalt:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
		</dynamic>
	</select>
</sqlMap> 
 