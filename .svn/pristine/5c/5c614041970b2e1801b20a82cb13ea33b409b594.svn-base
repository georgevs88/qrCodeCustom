<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Eps">
	<typeAlias alias="EpsVO" type="pmcg.fcn.domain.EpsVO" />


	<resultMap id="mapComplexQuerySimple" class="EpsVO">
		<result property="iddeps" column="iddeps" />
		<result property="pvieps" column="pvieps" />
		<result property="deseps" column="deseps" />
		<result property="capeps" column="capeps" />
		<result property="dineps" column="dineps" />
		<result property="emaeps" column="emaeps" />
		<result property="nomeps" column="nomeps" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="EpsVO">
		<result property="iddeps" column="iddeps" />
		<result property="pvieps" column="pvieps" />
		<result property="deseps" column="deseps" />
		<result property="capeps" column="capeps" />
		<result property="dineps" column="dineps" />
		<result property="emaeps" column="emaeps" />
		<result property="nomeps" column="nomeps" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcneps WHERE iddeps = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcneps WHERE iddeps = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="EpsVO"
		resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcneps
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddeps" prepend=" AND ">
				iddeps = #iddeps:NUMERIC#
			</isNotNull>
			<isNotNull property="pvieps" prepend=" AND ">
				pvieps ILIKE '%' || #pvieps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="deseps" prepend=" AND ">
				deseps ILIKE '%' || #deseps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="capeps" prepend=" AND ">
				capeps = #capeps:NUMERIC#
			</isNotNull>
			<isNotNull property="dineps" prepend=" AND ">
				to_char(dineps,'dd/MM/yyyy') =
				to_char(#dineps:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="emaeps" prepend=" AND ">
				emaeps ILIKE '%' || #emaeps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomeps" prepend=" AND ">
				nomeps ILIKE '%' || #nomeps:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="EpsVO"
		resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcneps
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddeps" prepend=" AND "> iddeps =
				#iddeps:NUMERIC#
			</isNotNull>
			<isNotNull property="pvieps" prepend=" AND ">
				pvieps ILIKE '%' || #pvieps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="deseps" prepend=" AND ">
				deseps ILIKE '%' || #deseps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="capeps" prepend=" AND "> capeps =
				#capeps:NUMERIC#
			</isNotNull>
			<isNotNull property="dineps" prepend=" AND ">
				to_char(dineps,'dd/MM/yyyy') =
				to_char(#dineps:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="emaeps" prepend=" AND ">
				emaeps ILIKE '%' || #emaeps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomeps" prepend=" AND ">
				nomeps ILIKE '%' || #nomeps:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcneps
	</select>

	<insert id="insReg" parameterClass="EpsVO">
		<selectKey keyProperty="iddeps" resultClass="Long">
			SELECT NEXTVAL('fcn.seqeps')
		</selectKey>
		INSERT INTO fcn.fcneps(iddeps,pvieps,deseps,capeps,dineps,emaeps,nomeps)
		VALUES (#iddeps:NUMERIC#, UPPER(#pvieps:VARCHAR#),
		UPPER(#deseps:VARCHAR#),#capeps:NUMERIC#,#dineps:TIMESTAMP#,
		UPPER(#emaeps:VARCHAR#), UPPER(#nomeps:VARCHAR#) )
	</insert>

	<update id="updRegByCod" parameterClass="EpsVO">
		UPDATE fcn.fcneps SET pvieps= UPPER(#pvieps:VARCHAR#),deseps=
		UPPER(#deseps:VARCHAR#),capeps= #capeps:NUMERIC#,dineps=
		#dineps:TIMESTAMP#,emaeps= UPPER(#emaeps:VARCHAR#),nomeps=
		UPPER(#nomeps:VARCHAR#) WHERE iddeps = #iddeps:NUMERIC#
	</update>
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM fcn.fcneps WHERE iddeps = #value:NUMERIC#
	</delete>
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM fcn.fcneps WHERE iddeps in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="EpsVO"
		resultClass="Integer">
		SELECT count(iddeps) FROM fcn.fcneps
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddeps" prepend=" AND "> iddeps =
				#iddeps:NUMERIC#
			</isNotNull>
			<isNotNull property="pvieps" prepend=" AND ">
				pvieps ILIKE '%' || #pvieps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="deseps" prepend=" AND ">
				deseps ILIKE '%' || #deseps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="capeps" prepend=" AND "> capeps =
				#capeps:NUMERIC#
			</isNotNull>
			<isNotNull property="dineps" prepend=" AND ">
				to_char(dineps,'dd/MM/yyyy') =
				to_char(#dineps:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="emaeps" prepend=" AND ">
				emaeps ILIKE '%' || #emaeps:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomeps" prepend=" AND ">
				nomeps ILIKE '%' || #nomeps:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
	</select>
</sqlMap> 
 