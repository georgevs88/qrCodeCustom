<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Eev">
	<typeAlias alias="EevVO" type="pmcg.fcn.domain.EevVO" />


	<resultMap id="mapComplexQuerySimple" class="EevVO">
		<result property="iddeev" column="iddeev" />
		<result property="proeev" column="proeev" />
		<result property="eveeev" column="eveeev" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="EevVO">
		<result property="iddeev" column="iddeev" />
		<result property="proeev" column="proeev" />
		<result property="eveeev" column="eveeev" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcneev WHERE iddeev = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcneev WHERE iddeev = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="EevVO"
		resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcneev
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddeev" prepend=" AND ">
				iddeev = #iddeev:NUMERIC#
			</isNotNull>
			<isNotNull property="proeev" prepend=" AND ">
				proeev = #proeev:NUMERIC#
			</isNotNull>
			<isNotNull property="eveeev" prepend=" AND ">
				eveeev ILIKE '%' || #eveeev:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="EevVO"
		resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcneev
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddeev" prepend=" AND "> iddeev =
				#iddeev:NUMERIC#
			</isNotNull>
			<isNotNull property="proeev" prepend=" AND "> proeev =
				#proeev:NUMERIC#
			</isNotNull>
			<isNotNull property="eveeev" prepend=" AND ">
				eveeev ILIKE '%' || #eveeev:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcneev
	</select>

	<insert id="insReg" parameterClass="EevVO">
		<selectKey keyProperty="iddeev" resultClass="Long">
			SELECT NEXTVAL('fcn.seqeev')
		</selectKey>
		INSERT INTO fcn.fcneev(iddeev,proeev,eveeev) VALUES
		(#iddeev:NUMERIC#,#proeev:NUMERIC#, UPPER(#eveeev:VARCHAR#) )
	</insert>

	<update id="updRegByCod" parameterClass="EevVO">
		UPDATE fcn.fcneev SET proeev= #proeev:NUMERIC#,eveeev= UPPER(#eveeev:VARCHAR#)
		WHERE iddeev = #iddeev:NUMERIC#
	</update>
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM fcn.fcneev WHERE iddeev = #value:NUMERIC#
	</delete>
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM fcn.fcneev WHERE iddeev in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="EevVO"
		resultClass="Integer">
		SELECT count(iddeev) FROM fcn.fcneev
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddeev" prepend=" AND "> iddeev =
				#iddeev:NUMERIC#
			</isNotNull>
			<isNotNull property="proeev" prepend=" AND "> proeev =
				#proeev:NUMERIC#
			</isNotNull>
			<isNotNull property="eveeev" prepend=" AND ">
				eveeev ILIKE '%' || #eveeev:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getEventosByPro" resultClass="hashmap">
		select 
			evt.codevt, evt.desevt 
		from 
			fcn.fcneev eev
			join fcn.fcnevt evt on evt.codevt = eev.eveeev
		where 
			eev.proeev = #value:NUMERIC#
	</select>
	
	<select id="getTransferenciaByPro" resultClass="Boolean" parameterClass="Long">
		select 
			case when count(0) > 0 then true else false end as transferencia 
		from 
			fcn.fcneev eev
		where 
			eev.proeev = #value:NUMERIC#
			and eev.eveeev = '039'
	</select>
</sqlMap> 
 