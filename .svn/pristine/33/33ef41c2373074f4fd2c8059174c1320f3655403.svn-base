<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Soscar">
	<typeAlias alias="CarVO" type="pmcg.imti.domain.CarVO" />

	<select id="getRegByCod" parameterClass="Integer" resultClass="CarVO">
		SELECT *
		FROM sos.soscar
		WHERE codcar = #value:NUMERIC#
	</select>

	<select id="getTodos" resultClass="CarVO">
		SELECT *
		FROM sos.soscar ORDER BY descar
	</select>

	<select id="getRegByCriterio" parameterClass="CarVO"
		resultClass="CarVO">
		SELECT *
		FROM sos.soscar
		<dynamic prepend=" WHERE ">
			<isNotNull property="codcar" prepend=" AND ">
				codcar =
				#codcar:NUMERIC#
			</isNotNull>
			<isNotNull property="descar" prepend=" AND ">
				UPPER(descar) LIKE '%'
				|| UPPER(#descar:VARCHAR#) || '%'
			</isNotNull>
		</dynamic>
		ORDER BY codcar
	</select>

	<insert id="insReg" parameterClass="CarVO">
		<selectKey keyProperty="codcar" resultClass="Integer">
			select nextval('sos.soscar_codcar_seq') as codcar
		</selectKey>
		INSERT INTO sos.soscar (codcar, descar, usualt, datalt)
		VALUES (#codcar:NUMERIC#, #descar:VARCHAR#,#usualt:VARCHAR#, now())
	</insert>

	<update id="updRegByCod" parameterClass="CarVO">
		UPDATE sos.soscar
		SET descar = #descar:VARCHAR#,
		usualt=#usualt:VARCHAR#,
		datalt=now()
		WHERE codcar = #codcar:NUMERIC#
	</update>

	<delete id="delByCod" parameterClass="Integer">
		DELETE FROM sos.soscar
		WHERE codcar = #value:NUMERIC#
	</delete>
	
	<select id="countRegByCriterio" parameterClass="CarVO" resultClass="Integer">
		SELECT count(*)
		FROM sos.soscar
		<dynamic prepend=" WHERE ">
			<isNotNull property="codcar" prepend=" AND ">
				codcar =
				#codcar:NUMERIC#
			</isNotNull>
			<isNotNull property="descar" prepend=" AND ">
				UPPER(descar) LIKE '%'
				|| UPPER(#descar:VARCHAR#) || '%'
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getCountByNome" parameterClass="CarVO" resultClass="Integer">
		SELECT  count(*) FROM sos.soscar
		WHERE UPPER (descar)=
		UPPER(#descar:VARCHAR#)
		<isNotNull property="codcar" prepend="AND">
			codcar != #codcar:NUMERIC#
		</isNotNull>
	</select>

</sqlMap>
