<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Usu">
	<typeAlias alias="UsuVO" type="pmcg.imti.domain.UsuVO" />

	<resultMap id="mapComplexQuerySimple" class="UsuVO">
		<result property="codusu" column="codusu" />
		<result property="logusu" column="logusu" />
		<result property="nomusu" column="nomusu" />
		<result property="atvusu" column="atvusu" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="UsuVO">
		<result property="codusu" column="codusu" />
		<result property="logusu" column="logusu" />
		<result property="nomusu" column="nomusu" />
		<result property="atvusu" column="atvusu" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM lic.licusu WHERE codusu = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM lic.licusu WHERE codusu = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="UsuVO" resultMap="mapComplexQuerySimple">
		SELECT * FROM lic.licusu
		<dynamic prepend=" WHERE ">
			<isNotNull property="codusu" prepend=" AND ">
				codusu = #codusu:NUMERIC#
			</isNotNull>
			<isNotNull property="logusu" prepend=" AND ">
				logusu ILIKE '%' || #logusu:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomusu" prepend=" AND ">
				nomusu ILIKE '%' || #nomusu:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
		order by nomusu
	</select>

	<select id="getRegByCriterioComplex" parameterClass="UsuVO" resultMap="mapComplexQuery">
		SELECT * FROM lic.licusu
		<dynamic prepend=" WHERE ">
			<isNotNull property="codusu" prepend=" AND "> codusu = #codusu:NUMERIC#
			</isNotNull>
			<isNotNull property="logusu" prepend=" AND ">
				logusu ILIKE '%' || #logusu:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomusu" prepend=" AND ">
				nomusu ILIKE '%' || #nomusu:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
		order by nomusu
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM lic.licusu ORDER BY ATVUSU DESC, NOMUSU
	</select>

	<insert id="insReg" parameterClass="UsuVO">
		<selectKey keyProperty="codusu" resultClass="Long">
			SELECT NEXTVAL('lic.seqlma')
		</selectKey>
		INSERT INTO lic.licusu(codusu,logusu,nomusu,atvusu) VALUES (#codusu:NUMERIC#, UPPER(#logusu:VARCHAR#), UPPER(#nomusu:VARCHAR#),#atvusu:BOOLEAN# )
	</insert>

	<update id="updRegByCod" parameterClass="UsuVO">
		UPDATE lic.licusu SET logusu= UPPER(#logusu:VARCHAR#),nomusu= UPPER(#nomusu:VARCHAR#),atvusu = #atvusu:BOOLEAN# WHERE codusu = #codusu:NUMERIC#
	</update>
	
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM lic.licusu WHERE codusu = #value:NUMERIC#
	</delete>
	
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM lic.licusu WHERE codusu in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="UsuVO" resultClass="Integer">
		SELECT count(codusu) FROM lic.licusu
		<dynamic prepend=" WHERE ">
			<isNotNull property="codusu" prepend=" AND "> codusu = #codusu:NUMERIC#
			</isNotNull>
			<isNotNull property="logusu" prepend=" AND ">
				logusu ILIKE '%' || #logusu:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nomusu" prepend=" AND ">
				nomusu ILIKE '%' || #nomusu:VARCHAR# || '%'
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getUsuByLog" parameterClass="String" resultClass="UsuVO">
		select * from lic.licusu where logusu = #value:VARCHAR#
	</select>
</sqlMap> 
 