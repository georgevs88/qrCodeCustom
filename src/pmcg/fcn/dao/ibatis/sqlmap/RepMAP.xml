<?xml version="1.0" encoding="UTF-8"?> 
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "HTTP://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Rep">
	<typeAlias alias="RepVO" type="pmcg.fcn.domain.RepVO" />

	<resultMap id="mapComplexQuerySimple" class="RepVO">
		<result property="iddrep" column="iddrep" />
		<result property="nomrep" column="nomrep" />
		<result property="cpfrep" column="cpfrep" />
		<result property="iderep" column="iderep" />
		<result property="oemrep" column="oemrep" />
		<result property="uforep" column="uforep" />
		<result property="dnarep" column="dnarep" />
		<result property="sexrep" column="sexrep" />
		<result property="nmarep" column="nmarep" />
		<result property="nparep" column="nparep" />
		<result property="dinrep" column="dinrep" />
		<result property="dfirep" column="dfirep" />
		<result property="prorep" column="prorep" />
		<result property="nacrep" column="nacrep" />
		<result property="endrep" column="endrep" />
		<result property="estrep" column="estrep" />
		<result property="trlrep" column="trlrep" />
		<result property="sadrep" column="sadrep" />
		<result property="qsirep" column="qsirep" />
	</resultMap>

	<resultMap id="mapComplexQuery" class="RepVO">
		<result property="iddrep" column="iddrep" />
		<result property="nomrep" column="nomrep" />
		<result property="cpfrep" column="cpfrep" />
		<result property="iderep" column="iderep" />
		<result property="oemrep" column="oemrep" />
		<result property="uforep" column="uforep" />
		<result property="dnarep" column="dnarep" />
		<result property="sexrep" column="sexrep" />
		<result property="nmarep" column="nmarep" />
		<result property="nparep" column="nparep" />
		<result property="dinrep" column="dinrep" />
		<result property="dfirep" column="dfirep" />
		<result property="prorep" column="prorep" />
		<result property="nacrep" column="nacrep" />
		<result property="endrep" column="endrep" />
		<result property="estrep" column="estrep" />
		<result property="trlrep" column="trlrep" />
		<result property="sadrep" column="sadrep" />
		<result property="qsirep" column="qsirep" />
	</resultMap>

	<select id="getRegByCod" parameterClass="Long" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnrep WHERE iddrep = #value:NUMERIC#
	</select>

	<select id="getRegByCodComplex" parameterClass="Long" resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnrep WHERE iddrep = #value:NUMERIC#
	</select>

	<select id="getRegByCriterio" parameterClass="RepVO"
		resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnrep
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddrep" prepend=" AND ">
				iddrep = #iddrep:NUMERIC#
			</isNotNull>
			<isNotNull property="nomrep" prepend=" AND ">
				nomrep ILIKE '%' || #nomrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="cpfrep" prepend=" AND ">
				cpfrep ILIKE '%' || #cpfrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="iderep" prepend=" AND ">
				iderep ILIKE '%' || #iderep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="oemrep" prepend=" AND ">
				oemrep ILIKE '%' || #oemrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="uforep" prepend=" AND ">
				uforep ILIKE '%' || #uforep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dnarep" prepend=" AND ">
				to_char(dnarep,'dd/MM/yyyy') =
				to_char(#dnarep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="sexrep" prepend=" AND ">
				sexrep ILIKE '%' || #sexrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nmarep" prepend=" AND ">
				nmarep ILIKE '%' || #nmarep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nparep" prepend=" AND ">
				nparep ILIKE '%' || #nparep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dinrep" prepend=" AND ">
				to_char(dinrep,'dd/MM/yyyy') =
				to_char(#dinrep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="dfirep" prepend=" AND ">
				to_char(dfirep,'dd/MM/yyyy') =
				to_char(#dfirep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="prorep" prepend=" AND ">
				prorep ILIKE '%' || #prorep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nacrep" prepend=" AND ">
				nacrep = #nacrep:NUMERIC#
			</isNotNull>
			<isNotNull property="endrep" prepend=" AND ">
				endrep = #endrep:NUMERIC#
			</isNotNull>
			<isNotNull property="estrep" prepend=" AND ">
				estrep = #estrep:NUMERIC#
			</isNotNull>
			<isNotNull property="trlrep" prepend=" AND ">
				trlrep = #trlrep:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>

	<select id="getRegByCriterioComplex" parameterClass="RepVO"
		resultMap="mapComplexQuery">
		SELECT * FROM fcn.fcnrep
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddrep" prepend=" AND "> iddrep =
				#iddrep:NUMERIC#
			</isNotNull>
			<isNotNull property="nomrep" prepend=" AND ">
				nomrep ILIKE '%' || #nomrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="cpfrep" prepend=" AND ">
				cpfrep ILIKE '%' || #cpfrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="iderep" prepend=" AND ">
				iderep ILIKE '%' || #iderep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="oemrep" prepend=" AND ">
				oemrep ILIKE '%' || #oemrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="uforep" prepend=" AND ">
				uforep ILIKE '%' || #uforep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dnarep" prepend=" AND ">
				to_char(dnarep,'dd/MM/yyyy') =
				to_char(#dnarep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="sexrep" prepend=" AND ">
				sexrep ILIKE '%' || #sexrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nmarep" prepend=" AND ">
				nmarep ILIKE '%' || #nmarep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nparep" prepend=" AND ">
				nparep ILIKE '%' || #nparep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dinrep" prepend=" AND ">
				to_char(dinrep,'dd/MM/yyyy') =
				to_char(#dinrep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="dfirep" prepend=" AND ">
				to_char(dfirep,'dd/MM/yyyy') =
				to_char(#dfirep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="prorep" prepend=" AND ">
				prorep ILIKE '%' || #prorep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nacrep" prepend=" AND "> nacrep =
				#nacrep:NUMERIC#
			</isNotNull>
			<isNotNull property="endrep" prepend=" AND "> endrep =
				#endrep:NUMERIC#
			</isNotNull>
			<isNotNull property="estrep" prepend=" AND "> estrep =
				#estrep:NUMERIC#
			</isNotNull>
			<isNotNull property="trlrep" prepend=" AND "> trlrep =
				#trlrep:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>

	<select id="getTodos" resultMap="mapComplexQuerySimple">
		SELECT * FROM fcn.fcnrep
	</select>

	<insert id="insReg" parameterClass="RepVO">
		<selectKey keyProperty="iddrep" resultClass="Long">
			SELECT NEXTVAL('fcn.seqrep')
		</selectKey>
		INSERT INTO
		fcn.fcnrep(iddrep,nomrep,cpfrep,iderep,oemrep,uforep,dnarep,sexrep,nmarep,nparep,dinrep,dfirep,prorep,nacrep,endrep,estrep,trlrep,sadrep,qsirep)
		VALUES (#iddrep:NUMERIC#, UPPER(#nomrep:VARCHAR#),
		UPPER(#cpfrep:VARCHAR#), UPPER(#iderep:VARCHAR#),
		UPPER(#oemrep:VARCHAR#), UPPER(#uforep:VARCHAR#),#dnarep:TIMESTAMP#,
		UPPER(#sexrep:VARCHAR#), UPPER(#nmarep:VARCHAR#),
		UPPER(#nparep:VARCHAR#),#dinrep:TIMESTAMP#,#dfirep:TIMESTAMP#,
		UPPER(#prorep:VARCHAR#),#nacrep:NUMERIC#,#endrep:NUMERIC#,#estrep:NUMERIC#,#trlrep:NUMERIC#,#sadrep:NUMERIC#,#qsirep:VARCHAR#
		)
	</insert>

	<update id="updRegByCod" parameterClass="RepVO">
		UPDATE fcn.fcnrep SET nomrep= UPPER(#nomrep:VARCHAR#),cpfrep=
		UPPER(#cpfrep:VARCHAR#),iderep= UPPER(#iderep:VARCHAR#),oemrep=
		UPPER(#oemrep:VARCHAR#),uforep= UPPER(#uforep:VARCHAR#),dnarep=
		#dnarep:TIMESTAMP#,sexrep= UPPER(#sexrep:VARCHAR#),nmarep=
		UPPER(#nmarep:VARCHAR#),nparep= UPPER(#nparep:VARCHAR#),dinrep=
		#dinrep:TIMESTAMP#,dfirep= #dfirep:TIMESTAMP#,prorep=
		UPPER(#prorep:VARCHAR#),nacrep= #nacrep:NUMERIC#,endrep=
		#endrep:NUMERIC#,estrep= #estrep:NUMERIC#,trlrep= #trlrep:NUMERIC#, sadrep = #sadrep:NUMERIC#,
		qsirep = #qsirep:VARCHAR#
		WHERE iddrep = #iddrep:NUMERIC#
	</update>
	
	<delete id="delByCod" parameterClass="Long">
		DELETE FROM fcn.fcnrep WHERE iddrep = #value:NUMERIC#
	</delete>
	
	<delete id="delByCodigos" parameterClass="String">
		DELETE FROM fcn.fcnrep WHERE iddrep in ($value$)
	</delete>

	<select id="getCountByCriterio" parameterClass="RepVO"
		resultClass="Integer">
		SELECT count(iddrep) FROM fcn.fcnrep
		<dynamic prepend=" WHERE ">
			<isNotNull property="iddrep" prepend=" AND "> iddrep =
				#iddrep:NUMERIC#
			</isNotNull>
			<isNotNull property="nomrep" prepend=" AND ">
				nomrep ILIKE '%' || #nomrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="cpfrep" prepend=" AND ">
				cpfrep ILIKE '%' || #cpfrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="iderep" prepend=" AND ">
				iderep ILIKE '%' || #iderep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="oemrep" prepend=" AND ">
				oemrep ILIKE '%' || #oemrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="uforep" prepend=" AND ">
				uforep ILIKE '%' || #uforep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dnarep" prepend=" AND ">
				to_char(dnarep,'dd/MM/yyyy') =
				to_char(#dnarep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="sexrep" prepend=" AND ">
				sexrep ILIKE '%' || #sexrep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nmarep" prepend=" AND ">
				nmarep ILIKE '%' || #nmarep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nparep" prepend=" AND ">
				nparep ILIKE '%' || #nparep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="dinrep" prepend=" AND ">
				to_char(dinrep,'dd/MM/yyyy') =
				to_char(#dinrep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="dfirep" prepend=" AND ">
				to_char(dfirep,'dd/MM/yyyy') =
				to_char(#dfirep:TIMESTAMP#,'dd/MM/yyyy')
			</isNotNull>
			<isNotNull property="prorep" prepend=" AND ">
				prorep ILIKE '%' || #prorep:VARCHAR# || '%'
			</isNotNull>
			<isNotNull property="nacrep" prepend=" AND "> nacrep =
				#nacrep:NUMERIC#
			</isNotNull>
			<isNotNull property="endrep" prepend=" AND "> endrep =
				#endrep:NUMERIC#
			</isNotNull>
			<isNotNull property="estrep" prepend=" AND "> estrep =
				#estrep:NUMERIC#
			</isNotNull>
			<isNotNull property="trlrep" prepend=" AND "> trlrep =
				#trlrep:NUMERIC#
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="getRegBySad" parameterClass="Long" resultClass="RepVO">
		SELECT * FROM fcn.fcnrep rep
		join fcn.fcnsad sad on sad.iddsad = rep.sadrep
		where sad.iddsad = #value:NUMERIC#
	</select>
	
	<select id="getRepBySad" parameterClass="Long" resultClass="hashmap">
		select 
			fcn.formatacpfcnpj(rep.cpfrep) as cpfrep, rep.nomrep, 
			rep.iderep,rep.oemrep,rep.uforep, to_char(rep.dnarep, 'dd/MM/yyyy') as dnarep,case when rep.sexrep = 'M' then 'Masculino' else 'Feminino' end as sexrep,
			rep.nmarep,rep.nparep,to_char(rep.dinrep, 'dd/MM/yyyy') as dinrep,to_char(rep.dfirep, 'dd/MM/yyyy') as dfirep,
			rep.prorep, tabnac.destab as nacrep,fcn.getendereco(rep.endrep) as endrep,
			tabecv.destab as estrep, tabtrl.destab as trlrep
		from 
			fcn.fcnrep rep 
			left join fcn.fcntab tabnac on (tabnac.tabtab = 'PAIS' AND tabnac.codtab = cast(rep.nacrep as varchar))
			left join fcn.fcntab tabecv on (tabecv.tabtab = 'ESTCIV' AND tabecv.codtab = cast(rep.estrep as varchar))
			left join fcn.fcntab tabtrl on (tabtrl.tabtab = 'TIPREP' AND tabtrl.codtab = cast(rep.trlrep as varchar))
		where 
			rep.sadrep = #value:NUMERIC#
	</select>
</sqlMap> 
 