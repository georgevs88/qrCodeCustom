<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Arqanx">
    <typeAlias alias="ArqanxVO" type="pmcg.imti.domain.ArqanxVO"/>
    
    <resultMap class="ArqanxVO" id="map">
    	<result property="seqarq" column="seqarq"/>	
    	<result property="codsis" column="codsis"/>	
    	<result property="anxarq" column="anxarq" javaType="java.lang.Object"/>	
    	<result property="tiparq" column="tiparq"/>	
    	<result property="nomarq" column="nomarq"/>	
    	<result property="obsarq" column="obsarq"/>	
    </resultMap>
    
    <select id="getRegByCodComplex" parameterClass="Long" resultMap="map">
        SELECT *
		  FROM fcn.arqanx
		 WHERE seqarq = #value:NUMERIC#
	</select>
    
    <select id="getRegByCod" parameterClass="Long" resultClass="ArqanxVO">
        SELECT seqarq, codsis, tiparq, nomarq, obsarq
		  FROM fcn.arqanx
		 WHERE seqarq = #value:NUMERIC#
	</select>

    <select id="getTodos" resultClass="ArqanxVO">
        SELECT seqarq, codsis, tiparq, nomarq, obsarq
		  FROM fcn.arqanx ORDER BY seqarq
	</select>

    <select id="getRegByCriterio" parameterClass="ArqanxVO" resultClass="ArqanxVO">
        SELECT seqarq, codsis, tiparq, nomarq, obsarq
		  FROM fcn.arqanx
		<dynamic prepend=" WHERE ">
			<isNotNull property="seqarq" prepend=" AND ">
				seqarq = #seqarq:NUMERIC#
			</isNotNull>
			<isNotNull property="codsis" prepend=" AND ">
				codsis = #codsis:NUMERIC#
			</isNotNull>
			<isNotNull property="anxarq" prepend=" AND ">
				anxarq = #anxarq#
			</isNotNull>
			<isNotNull property="tiparq" prepend=" AND ">
				UPPER(tiparq) LIKE '%' || UPPER(#tiparq:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="nomarq" prepend=" AND ">
				UPPER(nomarq) LIKE '%' || UPPER(#nomarq:VARCHAR#) || '%'
			</isNotNull>
			<isNotNull property="obsarq" prepend=" AND ">
				UPPER(obsarq) LIKE '%' || UPPER(#obsarq:VARCHAR#) || '%'
			</isNotNull>
		</dynamic>
	ORDER BY seqarq
	</select>

    <insert id="insReg" parameterClass="ArqanxVO">
        <selectKey keyProperty="seqarq" resultClass="Long">
			select nextval('fcn.arqanx_seqarq_seq'::regclass) as seqarq
		</selectKey>
		INSERT INTO fcn.arqanx 
			(seqarq, codsis, anxarq,
			 tiparq, nomarq, obsarq)
		VALUES 
			(#seqarq:NUMERIC#, #codsis:NUMERIC#, #anxarq#,
			 #tiparq:VARCHAR#, #nomarq:VARCHAR#, #obsarq:VARCHAR#)
	</insert>

    <update id="updRegByCod" parameterClass="ArqanxVO">
        UPDATE fcn.arqanx
		   SET codsis = #codsis:NUMERIC#,
			 anxarq = #anxarq#,
			 tiparq = #tiparq:VARCHAR#,
			 nomarq = #nomarq:VARCHAR#,
			 obsarq = #obsarq:VARCHAR#
		 WHERE seqarq = #seqarq:NUMERIC#
    </update>

    <delete id="delByCod" parameterClass="Long">
        DELETE FROM fcn.arqanx
		 WHERE seqarq = #value:NUMERIC#
    </delete>

	<select id="getAssinatura" parameterClass="Integer" resultClass="ArqanxVO">
		SELECT 
			seqarq, anxarq
		FROM 
			fcn.arqanx
		WHERE 
			codsis = 120 AND seqarq = #VALUE:NUMERIC#
	</select>
</sqlMap>