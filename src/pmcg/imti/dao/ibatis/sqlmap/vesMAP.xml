<?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE sqlMap PUBLIC "//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="Ves">
	<typeAlias alias="VesVO" type="pmcg.imti.domain.VesVO" />

	<resultMap class="VesVO" id="mapComplexQuery">
		<result property="codves" column="codves" />
		<result property="tipves" column="tipves" />
		<result property="setves" column="setves" />
		<result property="coddis" column="coddis" />
		<result property="razves" column="razves" />
		<result property="nofves" column="nofves" />
		<result property="cpfves" column="cpfves" />
		<result property="cnpves" column="cnpves" />
		<result property="imuves" column="imuves" />
		<result property="ineves" column="ineves" />
		<result property="dtives" column="dtives" />
		<result property="codnat" column="codnat" />
		<result property="cepves" column="cepves" />
		<result property="comves" column="comves" />
		<result property="nroves" column="nroves" />
		<result property="telves" column="telves" />
		<result property="emaves" column="emaves" />
		<result property="esgves" column="esgves" />
		<result property="usualt" column="usualt" />
		<result property="datalt" column="datalt" />
		<result property="letves" column="letves" />
		<result property="teaves" column="teaves" />
		<result property="licves" column="licves" />
		<result property="senves" column="senves" />
		<result property="datultvis" column="datultvis" />
		<result property="sttves" column="sttves" />
<!-- 		<result property="disVO" select="Dis.getRegByCod" column="coddis" /> -->
<!-- 		<result property="natVO" select="Sosnat.getRegByCod" column="codnat" /> -->
	</resultMap>


	<!-- <select id="getTodos" resultClass="VesVO"> -->
	<!-- SELECT * from sos.sosves -->
	<!-- </select> -->

	<!-- <select id="getRegByCod" parameterClass="Integer" resultClass="VesVO"> -->
	<!-- SELECT * FROM sos.sosves WHERE codves=#value:VARCHAR# -->
	<!-- </select> -->

	<insert id="insReg" parameterClass="VesVO">
		<selectKey keyProperty="codves" resultClass="Integer">
			select
			nextval('sos.sosves_codves_seq')
		</selectKey>
		INSERT INTO sos.sosves (codves, tipves, setves, coddis, razves,
		nofves, cpfves,
		cnpves, imuves, ineves, dtives, codnat, cepves, comves,
		nroves,
		telves, emaves, esgves, datalt, usualt, datultvis,sttves,
		codtiplog, codlog, codbai, codcid, coduf,letves, teaves, licves, senves)
		VALUES
		(#codves:NUMERIC#, #tipves:VARCHAR#, #setves:NUMERIC#,
		#coddis:NUMERIC#, #razves:VARCHAR#,
		#nofves:VARCHAR#, #cpfves:VARCHAR#,
		#cnpves:VARCHAR#, #imuves:VARCHAR#,
		#ineves:VARCHAR#,
		#dtives:TIMESTAMP#, #codnat:NUMERIC#,
		#cepves:VARCHAR#,
		#comves:VARCHAR#,
		#nroves:VARCHAR#, #telves:VARCHAR#, #emaves:VARCHAR#,
		#esgves:NUMERIC#, NOW(), #usualt:VARCHAR#, #datultvis:DATE#, 'A',
		#codtiplog:NUMERIC#, #codlog:NUMERIC#, #codbai:NUMERIC#,
		#codcid:NUMERIC#, #coduf:NUMERIC#, #letves:VARCHAR#, #teaves:VARCHAR#, #licves:VARCHAR#,
		#senves:VARCHAR#)
	</insert>

	<select id="getRegByCriterioL" parameterClass="VesVO"
		resultClass="VesVO">
		SELECT *
		FROM sos.sosves
		WHERE letves is not null
		<isNotNull property="codves" prepend=" AND ">
			codves = #codves:NUMERIC#
		</isNotNull>
		<isNotNull property="razves" prepend=" AND ">
			UPPER(razves) LIKE '%' || UPPER(#razves:VARCHAR#) || '%'
		</isNotNull>
	</select>

	<select id="getCountByCriterio" parameterClass="VesVO"
		resultClass="Integer">
		SELECT count(*)
		FROM sos.sosves
		WHERE letves is not null
		<isNotNull property="codves" prepend=" AND ">
			codves = #codves:NUMERIC#
		</isNotNull>
		<isNotNull property="razves" prepend=" AND ">
			UPPER(razves) LIKE '%' || UPPER(#razves:VARCHAR#) || '%'
		</isNotNull>
	</select>

	<update id="updRegByCod" parameterClass="VesVO">
		UPDATE sos.sosves
		SET
		codves = #codves:NUMERIC#, tipves = #tipves:VARCHAR#, setves
		=#setves:NUMERIC#,
		coddis = #coddis:NUMERIC#, razves =
		#razves:VARCHAR#,
		nofves = #nofves:VARCHAR#, cpfves = #cpfves:VARCHAR#,
		cnpves =
		#cnpves:VARCHAR#,
		imuves = #imuves:VARCHAR#, ineves =
		#ineves:VARCHAR#, dtives =
		#dtives:TIMESTAMP#,
		codnat =
		#codnat:NUMERIC#, cepves = #cepves:VARCHAR#, comves =
		#comves:VARCHAR#,
		nroves = #nroves:VARCHAR#, telves = #telves:VARCHAR#,
		emaves =
		#emaves:VARCHAR#,
		esgves = #esgves:NUMERIC#, datalt = NOW(),
		usualt = #usualt:VARCHAR#,
		datultvis = #datultvis:DATE#,
		sttves =
		#sttves:VARCHAR#,
		codtiplog = #codtiplog:NUMERIC#,
		codlog =
		#codlog:NUMERIC#,
		codbai = #codbai:NUMERIC#,
		codcid = #codcid:NUMERIC#,
		coduf = #coduf:NUMERIC#,
		letves=#letves:VARCHAR#,
		teaves=#teaves:VARCHAR#,
		licves=#licves:VARCHAR#,
		senves=#senves:VARCHAR#
		WHERE codves =
		#codves:NUMERIC#
	</update>
	
	<select id="getRegByCriterioVex" parameterClass="VesVO" resultMap="mapComplexQuery">
		SELECT * from sos.sosves
		WHERE		
			UPPER(cnpves) LIKE '%'	|| UPPER(#cnpves:VARCHAR#) || '%'
		order by codves
	</select>
	
	<select id="getRegByCriterio" parameterClass="VesVO" resultMap="mapComplexQuery">
		SELECT * from sos.sosves ves
		inner join sos.sosdis dis on
		(ves.coddis=dis.coddis)
		WHERE sttves IN ('A','I')
		<isNotNull property="codves" prepend=" AND ">
			codves =
			#codves:NUMERIC#
		</isNotNull>
		<isNotNull property="coddis" prepend=" AND ">
			ves.coddis=#coddis:NUMERIC#
		</isNotNull>
		<isNotNull property="disVO.coduni" prepend="AND">
			dis.coduni =
			#disVO.coduni:VARCHAR#
		</isNotNull>
		<isNotNull property="codnat" prepend=" AND ">
			codnat=#codnat:NUMERIC#
		</isNotNull>
		<isNotNull property="nofves" prepend=" AND ">
			nofves ILIKE '%' ||
			#nofves:VARCHAR# || '%'
		</isNotNull>
		<isNotNull property="razves" prepend=" AND ">
			razves ILIKE '%' ||
			#razves:VARCHAR# || '%'
		</isNotNull>
		<isNotNull property="cepves" prepend="AND">
			cepves =
			#cepves:VARCHAR#
		</isNotNull>
		<isNotNull property="cnpves" prepend="AND">
			UPPER(cnpves) LIKE '%'
			|| UPPER(#cnpves:VARCHAR#) || '%'
		</isNotNull>
		<isNotNull property="cpfves" prepend="AND">
			UPPER(cpfves) LIKE '%'
			|| UPPER(#cpfves:VARCHAR#) || '%'
		</isNotNull>
		<isNotNull property="nroves" prepend="AND">
			nroves =
			#nroves:VARCHAR#
		</isNotNull>
		<isNotNull property="imuves" prepend=" AND ">
			imuves ILIKE '%' ||
			#imuves:VARCHAR# || '%'
		</isNotNull>
		<isNotNull property="usualt" prepend="AND">
			ves.usualt =
			#usualt:VARCHAR#
		</isNotNull>
		<isNotNull property="datalt" prepend="AND">
			ves.datalt = #datalt:DATE#
		</isNotNull>
		<isNotNull property="sttves" prepend="AND">
			sttves =
			#sttves:VARCHAR#
		</isNotNull>
		<isNotNull property="codtiplog" prepend=" AND ">
			codtiplog=#codtiplog:NUMERIC#
		</isNotNull>
		<isNotNull property="codlog" prepend=" AND ">
			codlog=#codlog:NUMERIC#
		</isNotNull>
		<isNotNull property="codbai" prepend=" AND ">
			codbai=#codbai:NUMERIC#
		</isNotNull>
		<isNotNull property="codcid" prepend=" AND ">
			codcid=#codcid:NUMERIC#
		</isNotNull>
		<isNotNull property="coduf" prepend=" AND ">
			coduf=#coduf:NUMERIC#
		</isNotNull>
		<isNotNull property="teaves" prepend="AND">
			teaves =
			#teaves:VARCHAR#
		</isNotNull>
		<isNotNull property="licves" prepend="AND">
			licves =
			#licves:VARCHAR#
		</isNotNull>
		<isNotNull property="senves" prepend="AND">
			senves =
			#senves:VARCHAR#
		</isNotNull>
		order by codves
	</select>

	<select id="countRegByCriterio" parameterClass="VesVO"
		resultClass="Integer">
		SELECT COUNT (*) from sos.sosves ves
		inner join sos.sosdis dis on
		(ves.coddis=dis.coddis)
		WHERE sttves IN ('A','I')
		<isNotNull property="codves" prepend=" AND ">
			codves=#codves:NUMERIC#
		</isNotNull>
		<isNotNull property="coddis" prepend=" AND ">
			ves.coddis=#coddis:NUMERIC#
		</isNotNull>
		<isNotNull property="disVO.coduni" prepend="AND">
			dis.coduni =
			#disVO.coduni:VARCHAR#
		</isNotNull>
		<isNotNull property="codnat" prepend=" AND ">
			codnat=#codnat:NUMERIC#
		</isNotNull>
		<isNotNull property="nofves" prepend=" AND ">
			nofves ILIKE '%' ||
			#nofves:VARCHAR# || '%'
		</isNotNull>
		<isNotNull property="razves" prepend=" AND ">
			razves ILIKE '%' ||
			#razves:VARCHAR# || '%'
		</isNotNull>
		<isNotNull property="cepves" prepend="AND">
			cepves =
			#cepves:VARCHAR#
		</isNotNull>
		<isNotNull property="cnpves" prepend="AND">
			UPPER(cnpves) LIKE '%'
			|| UPPER(#cnpves:VARCHAR#) || '%'
		</isNotNull>
		<isNotNull property="cpfves" prepend="AND">
			UPPER(cpfves) LIKE '%'
			|| UPPER(#cpfves:VARCHAR#) || '%'
		</isNotNull>
		<isNotNull property="nroves" prepend="AND">
			nroves =
			#nroves:VARCHAR#
		</isNotNull>
		<isNotNull property="imuves" prepend=" AND ">
			imuves ILIKE '%' ||
			#imuves:VARCHAR# || '%'
		</isNotNull>
		<isNotNull property="usualt" prepend="AND">
			ves.usualt =
			#usualt:VARCHAR#
		</isNotNull>
		<isNotNull property="datalt" prepend="AND">
			ves.datalt = #datalt:DATE#
		</isNotNull>
		<isNotNull property="sttves" prepend="AND">
			sttves =
			#sttves:VARCHAR#
		</isNotNull>
		<isNotNull property="codtiplog" prepend=" AND ">
			codtiplog=#codtiplog:NUMERIC#
		</isNotNull>
		<isNotNull property="codlog" prepend=" AND ">
			codlog=#codlog:NUMERIC#
		</isNotNull>
		<isNotNull property="codbai" prepend=" AND ">
			codbai=#codbai:NUMERIC#
		</isNotNull>
		<isNotNull property="codcid" prepend=" AND ">
			codcid=#codcid:NUMERIC#
		</isNotNull>
		<isNotNull property="coduf" prepend=" AND ">
			coduf=#coduf:NUMERIC#
		</isNotNull>
		<isNotNull property="teaves" prepend=" AND ">
			teaves=#teaves:VARCHAR#
		</isNotNull>
		<isNotNull property="licves" prepend="AND">
			licves =
			#licves:VARCHAR#
		</isNotNull>
		<isNotNull property="senves" prepend=" AND ">
			senves=#senves:VARCHAR#
		</isNotNull>
	</select>

	<select id="getRegByCod" parameterClass="Integer" resultClass="VesVO">
		SELECT * FROM sos.sosves
		WHERE codves = #value:NUMERIC#
	</select>

	<select id="getCountByDesc" parameterClass="VesVO" resultClass="Integer">
		SELECT
		count(codves)
		FROM
		sos.sosves
		WHERE
		UPPER(nofves) =
		UPPER(#nofves:VARCHAR#)
		<isNotNull property="codves">
			AND codves != #codves:NUMERIC#
		</isNotNull>
	</select>

	<select id="getCountByCPF" parameterClass="VesVO" resultClass="Integer">
		SELECT
		count(codves)
		FROM
		sos.sosves
		WHERE
		cpfves = #cpfves:VARCHAR# AND
		sttves IN ('A')
		<isNotNull property="codves">
			AND codves != #codves:NUMERIC#
		</isNotNull>
	</select>

	<select id="getCountByCNPJ" parameterClass="VesVO" resultClass="Integer">
		SELECT
		count(codves)
		FROM
		sos.sosves
		WHERE
		cnpves = #cnpves:VARCHAR# AND
		sttves IN ('A')
		<isNotNull property="codves">
			AND codves != #codves:NUMERIC#
		</isNotNull>
	</select>


	<select id="getEstabbyRT" parameterClass="hashmap" resultClass="VesVO">
		select ves.*
		from sos.sosrte rte
		inner join sos.sosvrt vrt on
		(rte.codvrt = vrt.codvrt)
		inner join sos.sosves ves on (rte.codves =
		ves.codves)
		where rte.codvrt = #codvrt:NUMERIC# and rte.codves !=
		#codves:NUMERIC#
	</select>

	<select id="getBuscaUltimaLetra" resultClass="String">
		select max(letves)
		from sos.sosves
	</select>
	
	<select id="getRegByLoginSenha" resultMap="mapComplexQuery" parameterClass="hashmap">
		SELECT *
		  FROM sos.sosves
		  
		  WHERE REPLACE(REPLACE(REPLACE(cnpves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(imuves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(cpfves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   and senves ilike #senha:VARCHAR#
		limit 1
			   
	</select>
	
	<select id="countRegByLoginSenha" resultClass="Integer" parameterClass="hashmap">
		SELECT count(*)
			FROM sos.sosves
		  
		  WHERE REPLACE(REPLACE(REPLACE(cnpves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(imuves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(cpfves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   and senves ilike #senha:VARCHAR#
	</select>
	
	<update id="updateSenves" parameterClass="hashmap">
		UPDATE sos.sosves
			SET senves = #senha:VARCHAR#
			 WHERE REPLACE(REPLACE(REPLACE(cnpves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(imuves,'.',''),'/',''),'-','')  like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(cpfves,'.',''),'/',''),'-','')  like #login:VARCHAR#
	</update>
	
	<select id="getRegByLogin" parameterClass="String" resultClass="VesVO">
		SELECT * 
		FROM sos.sosves 
		 WHERE REPLACE(REPLACE(REPLACE(cnpves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(imuves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(cpfves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   limit 1
	</select>
	
	<select id="countRegByLogin" parameterClass="String" resultClass="Integer">
	SELECT count(*) 
		FROM sos.sosves 
		 WHERE REPLACE(REPLACE(REPLACE(cnpves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(imuves,'.',''),'/',''),'-','') like #login:VARCHAR#
			   or REPLACE(REPLACE(REPLACE(cpfves,'.',''),'/',''),'-','') like #login:VARCHAR#
	</select>

</sqlMap>
